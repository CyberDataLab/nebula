
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="NEBULA: A Platform for Decentralized Federated Learning">
      
      
        <meta name="author" content="Enrique Tomás Martínez Beltrán">
      
      
        <link rel="canonical" href="https://nebula.enriquetomasmb.com/api/addons/reputation/reputation/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../topologymanager/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>reputation - NEBULA</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../css/toc.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-reputation-module" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="NEBULA" class="md-header__button md-logo" aria-label="NEBULA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NEBULA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              reputation
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="deep-orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/CyberDataLab/nebula" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    CyberDataLab/nebula
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../installation/" class="md-tabs__link">
        
  
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../userguide/" class="md-tabs__link">
        
  
  
    
  
  User Guide

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../developerguide/" class="md-tabs__link">
        
  
  
    
  
  Developer Guide

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../contributing/" class="md-tabs__link">
        
  
  
    
  
  Contributing

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="NEBULA" class="md-nav__button md-logo" aria-label="NEBULA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NEBULA
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/CyberDataLab/nebula" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    CyberDataLab/nebula
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../userguide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developerguide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    nebula
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            nebula
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    addons
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1" id="__nav_5_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1">
            <span class="md-nav__icon md-icon"></span>
            addons
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../attacks/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    attacks
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_1" id="__nav_5_1_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_1">
            <span class="md-nav__icon md-icon"></span>
            attacks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/attacks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    attacks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../attacks/communications/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    communications
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_1_2" id="__nav_5_1_1_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            communications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/communications/communicationattack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    communicationattack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/communications/delayerattack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    delayerattack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/communications/floodingattack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    floodingattack
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../attacks/dataset/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    dataset
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_1_3" id="__nav_5_1_1_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_1_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_1_3">
            <span class="md-nav__icon md-icon"></span>
            dataset
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/dataset/datapoison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datapoison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/dataset/datasetattack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datasetattack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/dataset/labelflipping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    labelflipping
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../attacks/model/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    model
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_1_4" id="__nav_5_1_1_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_1_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_1_4">
            <span class="md-nav__icon md-icon"></span>
            model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/model/gllneuroninversion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gllneuroninversion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/model/modelattack/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    modelattack
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/model/modelpoison/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    modelpoison
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../attacks/model/swappingweights/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    swappingweights
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blockchain/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    blockchain
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_2" id="__nav_5_1_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_2">
            <span class="md-nav__icon md-icon"></span>
            blockchain
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/blockchain_deployer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    blockchain_deployer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/chaincode/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    chaincode
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/geth/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    geth
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../blockchain/oracle/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    oracle
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_2_4" id="__nav_5_1_1_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            oracle
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../blockchain/oracle/app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    app
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../env/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    env
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    functions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../gps/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    gps
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_5" id="__nav_5_1_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_5">
            <span class="md-nav__icon md-icon"></span>
            gps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gps/gpsmodule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    gpsmodule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../gps/nebulagps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebulagps
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mobility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mobility
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../networksimulation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    networksimulation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_7" id="__nav_5_1_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_7">
            <span class="md-nav__icon md-icon"></span>
            networksimulation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networksimulation/nebulanetworksimulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebulanetworksimulator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../networksimulation/networksimulator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    networksimulator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../reporter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    reporter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_9" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    reputation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_9" id="__nav_5_1_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1_1_9">
            <span class="md-nav__icon md-icon"></span>
            reputation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    reputation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    reputation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation" class="md-nav__link">
    <span class="md-ellipsis">
      reputation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Metrics.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation" class="md-nav__link">
    <span class="md-ellipsis">
      Reputation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reputation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.engine" class="md-nav__link">
    <span class="md-ellipsis">
      engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.analyze_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_decay_rate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_decay_rate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_similarity_from_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_similarity_from_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_value_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_value_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_weighted_values" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_weighted_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.create_graphic_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      create_graphic_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.create_graphics_to_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      create_graphics_to_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.include_feedback_in_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      include_feedback_in_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.init_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      init_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.is_valid_ip" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.manage_metric_number_message" class="md-nav__link">
    <span class="md-ellipsis">
      manage_metric_number_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.manage_model_arrival_latency" class="md-nav__link">
    <span class="md-ellipsis">
      manage_model_arrival_latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.on_round_start" class="md-nav__link">
    <span class="md-ellipsis">
      on_round_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_fraction_of_parameters_changed" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_fraction_of_parameters_changed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_model_arrival_latency" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_model_arrival_latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_number_message" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_number_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_model_arrival_latency_history" class="md-nav__link">
    <span class="md-ellipsis">
      save_model_arrival_latency_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_number_message_history" class="md-nav__link">
    <span class="md-ellipsis">
      save_number_message_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_reputation_history_in_memory" class="md-nav__link">
    <span class="md-ellipsis">
      save_reputation_history_in_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.send_reputation_to_neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      send_reputation_to_neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.update_process_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      update_process_aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../topologymanager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    topologymanager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_1_11" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../trustworthiness/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    trustworthiness
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_1_11" id="__nav_5_1_1_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_1_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_1_11">
            <span class="md-nav__icon md-icon"></span>
            trustworthiness
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trustworthiness/calculation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    calculation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trustworthiness/factsheet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    factsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trustworthiness/metric/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    metric
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trustworthiness/pillar/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pillar
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../trustworthiness/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../waf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    waf
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../controller/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    controller
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            controller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controller/controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controller/database/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    database
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../controller/scenarios/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    scenarios
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    core
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/addonmanager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    addonmanager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/aggregation/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    aggregation
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_2" id="__nav_5_1_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_2">
            <span class="md-nav__icon md-icon"></span>
            aggregation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/aggregator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aggregator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/blockchainReputation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    blockchainReputation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/fedavg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fedavg
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/krum/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    krum
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/median/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    median
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/trimmedmean/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    trimmedmean
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_2_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/aggregation/updatehandlers/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    updatehandlers
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_2_7" id="__nav_5_1_3_2_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_2_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_2_7">
            <span class="md-nav__icon md-icon"></span>
            updatehandlers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/updatehandlers/cflupdatehandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cflupdatehandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/updatehandlers/dflupdatehandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    dflupdatehandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/updatehandlers/sdflupdatehandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sdflupdatehandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/aggregation/updatehandlers/updatehandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    updatehandler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    datasets
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3" id="__nav_5_1_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3">
            <span class="md-nav__icon md-icon"></span>
            datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/changeablesubset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    changeablesubset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/cifar10/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    cifar10
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3_2" id="__nav_5_1_3_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3_2">
            <span class="md-nav__icon md-icon"></span>
            cifar10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/cifar10/cifar10/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cifar10
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/cifar100/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    cifar100
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3_3" id="__nav_5_1_3_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3_3">
            <span class="md-nav__icon md-icon"></span>
            cifar100
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/cifar100/cifar100/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cifar100
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/datamodule/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    datamodule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/emnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    emnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3_5" id="__nav_5_1_3_3_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3_5">
            <span class="md-nav__icon md-icon"></span>
            emnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/emnist/emnist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    emnist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/fashionmnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    fashionmnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3_6" id="__nav_5_1_3_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3_6">
            <span class="md-nav__icon md-icon"></span>
            fashionmnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/fashionmnist/fashionmnist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fashionmnist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_3_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/datasets/mnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    mnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_3_7" id="__nav_5_1_3_3_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_3_7">
            <span class="md-nav__icon md-icon"></span>
            mnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/mnist/mnist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mnist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/datasets/nebuladataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebuladataset
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/engine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    engine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/eventmanager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    eventmanager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    models
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6" id="__nav_5_1_3_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6">
            <span class="md-nav__icon md-icon"></span>
            models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/cifar10/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    cifar10
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_1" id="__nav_5_1_3_6_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_1">
            <span class="md-nav__icon md-icon"></span>
            cifar10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/cnnV2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnnV2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/cnnV3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnnV3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/fastermobilenet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fastermobilenet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/resnet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    resnet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar10/simplemobilenet/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    simplemobilenet
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/cifar100/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    cifar100
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_2" id="__nav_5_1_3_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_2">
            <span class="md-nav__icon md-icon"></span>
            cifar100
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/cifar100/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/emnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    emnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_3" id="__nav_5_1_3_6_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_3">
            <span class="md-nav__icon md-icon"></span>
            emnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/emnist/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/emnist/mlp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mlp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/fashionmnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    fashionmnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_4" id="__nav_5_1_3_6_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_4">
            <span class="md-nav__icon md-icon"></span>
            fashionmnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/fashionmnist/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/fashionmnist/mlp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mlp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_5" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/mnist/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    mnist
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_5" id="__nav_5_1_3_6_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_5">
            <span class="md-nav__icon md-icon"></span>
            mnist
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/mnist/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/mnist/mlp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    mlp
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/nebulamodel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebulamodel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_6_7" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/models/sentiment140/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    sentiment140
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_6_7" id="__nav_5_1_3_6_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_6_7">
            <span class="md-nav__icon md-icon"></span>
            sentiment140
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/sentiment140/cnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    cnn
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/models/sentiment140/rnn/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    rnn
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/nebulaevents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebulaevents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_8" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/network/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    network
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_8" id="__nav_5_1_3_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_8">
            <span class="md-nav__icon md-icon"></span>
            network
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/blacklist/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    blacklist
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/communications/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    communications
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/connection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    connection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/discoverer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    discoverer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_8_6" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/network/externalconnection/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    externalconnection
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_8_6" id="__nav_5_1_3_8_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_8_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_8_6">
            <span class="md-nav__icon md-icon"></span>
            externalconnection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/externalconnection/externalconnectionservice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    externalconnectionservice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/externalconnection/nebuladiscoveryservice/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebuladiscoveryservice
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/forwarder/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    forwarder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/health/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    health
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/messages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/network/propagator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    propagator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/node/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    node
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_10" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/pb/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    pb
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_10" id="__nav_5_1_3_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_10">
            <span class="md-nav__icon md-icon"></span>
            pb
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/pb/nebula_pb2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    nebula_pb2
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/role/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    role
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    situationalawareness
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12" id="__nav_5_1_3_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12">
            <span class="md-nav__icon md-icon"></span>
            situationalawareness
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/awareness/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    awareness
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_1" id="__nav_5_1_3_12_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_12_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_1">
            <span class="md-nav__icon md-icon"></span>
            awareness
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_1_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/awareness/arbitrationpolicies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    arbitrationpolicies
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_1_1" id="__nav_5_1_3_12_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_5_1_3_12_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_1_1">
            <span class="md-nav__icon md-icon"></span>
            arbitrationpolicies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/arbitrationpolicies/arbitrationpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    arbitrationpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/arbitrationpolicies/staticarbitrationpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    staticarbitrationpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_1_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/awareness/sanetwork/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    sanetwork
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_1_2" id="__nav_5_1_3_12_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_5_1_3_12_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_1_2">
            <span class="md-nav__icon md-icon"></span>
            sanetwork
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_1_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    neighborpolicies
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_1_2_1" id="__nav_5_1_3_12_1_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="7" aria-labelledby="__nav_5_1_3_12_1_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_1_2_1">
            <span class="md-nav__icon md-icon"></span>
            neighborpolicies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/distanceneighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    distanceneighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/fcneighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fcneighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/idleneighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    idleneighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/neighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    neighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/ringneighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ringneighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/neighborpolicies/starneighborpolicy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    starneighborpolicy
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sanetwork/sanetwork/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sanetwork
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sareasoner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sareasoner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/awareness/sautils/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    sautils
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_1_4" id="__nav_5_1_3_12_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_5_1_3_12_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_1_4">
            <span class="md-nav__icon md-icon"></span>
            sautils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sautils/sacommand/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sacommand
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sautils/samoduleagent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    samoduleagent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/sautils/sasystemmonitor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    sasystemmonitor
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/awareness/suggestionbuffer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    suggestionbuffer
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_2" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/discovery/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    discovery
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_2" id="__nav_5_1_3_12_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_5_1_3_12_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_2">
            <span class="md-nav__icon md-icon"></span>
            discovery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_2_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/discovery/candidateselection/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    candidateselection
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_2_1" id="__nav_5_1_3_12_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_5_1_3_12_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_2_1">
            <span class="md-nav__icon md-icon"></span>
            candidateselection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/candidateselection/candidateselector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    candidateselector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/candidateselection/distcandidateselector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    distcandidateselector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/candidateselection/fccandidateselector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    fccandidateselector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/candidateselection/ringcandidateselector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ringcandidateselector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/candidateselection/stdcandidateselector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stdcandidateselector
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/federationconnector/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    federationconnector
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_12_2_3" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/situationalawareness/discovery/modelhandlers/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    modelhandlers
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_12_2_3" id="__nav_5_1_3_12_2_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="6" aria-labelledby="__nav_5_1_3_12_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_12_2_3">
            <span class="md-nav__icon md-icon"></span>
            modelhandlers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/modelhandlers/aggmodelhandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    aggmodelhandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/modelhandlers/defaultmodelhandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    defaultmodelhandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/modelhandlers/modelhandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    modelhandler
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/discovery/modelhandlers/stdmodelhandler/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    stdmodelhandler
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/situationalawareness/situationalawareness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    situationalawareness
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3_13" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../core/training/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    training
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_3_13" id="__nav_5_1_3_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_3_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3_13">
            <span class="md-nav__icon md-icon"></span>
            training
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/training/lightning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    lightning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/training/scikit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    scikit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../core/training/siamese/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    siamese
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../frontend/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    frontend
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            frontend
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../frontend/app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    app
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation" class="md-nav__link">
    <span class="md-ellipsis">
      reputation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Metrics.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation" class="md-nav__link">
    <span class="md-ellipsis">
      Reputation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reputation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.engine" class="md-nav__link">
    <span class="md-ellipsis">
      engine
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.analyze_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_decay_rate" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_decay_rate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_similarity_from_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_similarity_from_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_value_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_value_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.calculate_weighted_values" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_weighted_values
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.create_graphic_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      create_graphic_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.create_graphics_to_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      create_graphics_to_metrics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.include_feedback_in_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      include_feedback_in_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.init_reputation" class="md-nav__link">
    <span class="md-ellipsis">
      init_reputation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.is_valid_ip" class="md-nav__link">
    <span class="md-ellipsis">
      is_valid_ip
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.manage_metric_number_message" class="md-nav__link">
    <span class="md-ellipsis">
      manage_metric_number_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.manage_model_arrival_latency" class="md-nav__link">
    <span class="md-ellipsis">
      manage_model_arrival_latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.on_round_start" class="md-nav__link">
    <span class="md-ellipsis">
      on_round_start
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_fraction_of_parameters_changed" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_fraction_of_parameters_changed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_model_arrival_latency" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_model_arrival_latency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_number_message" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_number_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.recollect_similarity" class="md-nav__link">
    <span class="md-ellipsis">
      recollect_similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_data" class="md-nav__link">
    <span class="md-ellipsis">
      save_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_model_arrival_latency_history" class="md-nav__link">
    <span class="md-ellipsis">
      save_model_arrival_latency_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_number_message_history" class="md-nav__link">
    <span class="md-ellipsis">
      save_number_message_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.save_reputation_history_in_memory" class="md-nav__link">
    <span class="md-ellipsis">
      save_reputation_history_in_memory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.send_reputation_to_neighbors" class="md-nav__link">
    <span class="md-ellipsis">
      send_reputation_to_neighbors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.setup" class="md-nav__link">
    <span class="md-ellipsis">
      setup
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#nebula.addons.reputation.reputation.Reputation.update_process_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      update_process_aggregation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


<h1 id="documentation-for-reputation-module">Documentation for Reputation Module<a class="headerlink" href="#documentation-for-reputation-module" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="nebula.addons.reputation.reputation"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="nebula.addons.reputation.reputation.Metrics" class="doc doc-heading">
            <code>Metrics</code>


<a href="#nebula.addons.reputation.reputation.Metrics" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">








              <details class="quote">
                <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Metrics</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a Metrics instance to store various evaluation metrics for a participant.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_round (optional): The current round number.</span>
<span class="sd">            current_round (optional): The round when the metric is measured.</span>
<span class="sd">            fraction_changed (optional): Fraction of parameters changed.</span>
<span class="sd">            threshold (optional): Threshold used for evaluating changes.</span>
<span class="sd">            latency (optional): Latency value for model arrival.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span> <span class="s2">&quot;round_received&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Metrics.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Metrics.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize a Metrics instance to store various evaluation metrics for a participant.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_round</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The round when the metric is measured.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction_changed</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of parameters changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold used for evaluating changes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>latency</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latency value for model arrival.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a Metrics instance to store various evaluation metrics for a participant.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_round (optional): The current round number.</span>
<span class="sd">        current_round (optional): The round when the metric is measured.</span>
<span class="sd">        fraction_changed (optional): Fraction of parameters changed.</span>
<span class="sd">        threshold (optional): Threshold used for evaluating changes.</span>
<span class="sd">        latency (optional): Latency value for model arrival.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
        <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span> <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span> <span class="s2">&quot;round_received&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">similarity</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="nebula.addons.reputation.reputation.Reputation" class="doc doc-heading">
            <code>Reputation</code>


<a href="#nebula.addons.reputation.reputation.Reputation" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Class to define and manage the reputation of a participant in the network.</p>
<p>The class handles collection of metrics, calculation of static and dynamic reputation,
updating history, and communication of reputation scores to neighbors.</p>







              <details class="quote">
                <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Reputation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to define and manage the reputation of a participant in the network.</span>

<span class="sd">    The class handles collection of metrics, calculation of static and dynamic reputation,</span>
<span class="sd">    updating history, and communication of reputation scores to neighbors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="s2">&quot;Engine&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="s2">&quot;Config&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the Reputation system.</span>

<span class="sd">        Args:</span>
<span class="sd">            engine (Engine): The engine instance providing the runtime context.</span>
<span class="sd">            config (Config): The configuration object with participant settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_feedback</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_messages_received_from_sources</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_reputation_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_threshold_number_message</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_std_dev_number_message</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages_model_arrival_latency</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">addr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">log_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">idx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">neighbors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;network_args&quot;</span><span class="p">][</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;with_reputation&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;reputation_metrics&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;initial_reputation&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weighting_factor&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_model_arrival_latency&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_model_similarity&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_num_messages&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_fraction_params_changed&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Reputation system: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reputation metrics: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initial reputation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighting factor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight model arrival latency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight model similarity: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight number of messages: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight fraction of parameters changed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">print_msg_box</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Defense information&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">engine</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the engine instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">type_data</span><span class="p">,</span>
        <span class="n">nei</span><span class="p">,</span>
        <span class="n">addr</span><span class="p">,</span>
        <span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">total_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">changed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">changes_record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save data received from nodes for further reputation calculations.</span>

<span class="sd">        Args:</span>
<span class="sd">            type_data (str): The type of data being saved (&quot;number_message&quot;, &quot;fraction_of_params_changed&quot;, or &quot;model_arrival_latency&quot;).</span>
<span class="sd">            nei (str): The neighbor node address.</span>
<span class="sd">            addr (str): The current node address.</span>
<span class="sd">            num_round (optional): The round number associated with the data.</span>
<span class="sd">            time (optional): Timestamp or time value.</span>
<span class="sd">            current_round (optional): The current round number.</span>
<span class="sd">            fraction_changed (optional): Fraction of parameters changed.</span>
<span class="sd">            total_params (optional): Total number of parameters.</span>
<span class="sd">            changed_params (optional): Number of changed parameters.</span>
<span class="sd">            threshold (optional): Threshold used for metrics.</span>
<span class="sd">            changes_record (optional): Record of parameter changes.</span>
<span class="sd">            latency (optional): Latency value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">addr</span> <span class="o">==</span> <span class="n">nei</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">combined_data</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;number_message&quot;</span><span class="p">:</span>
                <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;number_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                    <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">:</span>
                <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span>
                <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
                    <span class="s2">&quot;round_received&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
                <span class="p">}</span>

            <span class="k">if</span> <span class="n">nei</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;number_message&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;number_message&quot;</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">])</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving data&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Setup the reputation system by subscribing to various events.</span>

<span class="sd">        This function enables the reputation system and subscribes to events based on active metrics.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reputation system enabled&quot;</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">RoundStartEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_round_start</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">AggregationEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_reputation</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_similarity</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span>
                    <span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_fraction_of_parameters_changed</span>
                <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;initialization&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;alive&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;federation&quot;</span><span class="p">,</span> <span class="s2">&quot;federation_models_included&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span>
                <span class="p">)</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;reputation&quot;</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span>
                    <span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_model_arrival_latency</span>
                <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_reputation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">federation_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_feedback_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_reputation</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the reputation for each federation node.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The address of the current node.</span>
<span class="sd">            federation_nodes (list): List of federation nodes&#39; addresses.</span>
<span class="sd">            round_num (int): The current round number.</span>
<span class="sd">            last_feedback_round (int): The last round in which feedback was provided.</span>
<span class="sd">            init_reputation (float): The initial reputation value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">federation_nodes</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;init_reputation | No federation nodes provided&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
            <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_ip</span><span class="p">(</span><span class="n">federation_nodes</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbors</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;init_reputation | No neighbors found&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">nei</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">init_reputation</span><span class="p">,</span>
                        <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
                        <span class="s2">&quot;last_feedback_round&quot;</span><span class="p">:</span> <span class="n">last_feedback_round</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_reputation</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">round_num</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;last_feedback_round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_feedback_round</span>

                <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">init_reputation</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">federation_nodes</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if the IP addresses provided are valid.</span>

<span class="sd">        Args:</span>
<span class="sd">            federation_nodes (list): List of federation node addresses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of valid IP addresses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_ip</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">federation_nodes</span><span class="p">:</span>
            <span class="n">valid_ip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">valid_ip</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_static_reputation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addr</span><span class="p">,</span>
        <span class="n">nei</span><span class="p">,</span>
        <span class="n">metric_messages_number</span><span class="p">,</span>
        <span class="n">metric_similarity</span><span class="p">,</span>
        <span class="n">metric_fraction</span><span class="p">,</span>
        <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
        <span class="n">weight_messages_number</span><span class="p">,</span>
        <span class="n">weight_similarity</span><span class="p">,</span>
        <span class="n">weight_fraction</span><span class="p">,</span>
        <span class="n">weight_model_arrival_latency</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the static reputation of a participant using fixed weights.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The IP address of the current node.</span>
<span class="sd">            nei (str): The neighbor node&#39;s IP address.</span>
<span class="sd">            metric_messages_number (float): Metric value for number of messages.</span>
<span class="sd">            metric_similarity (float): Metric value for model similarity.</span>
<span class="sd">            metric_fraction (float): Metric value for fraction of parameters changed.</span>
<span class="sd">            metric_model_arrival_latency (float): Metric value for model arrival latency.</span>
<span class="sd">            weight_messages_number (float): Weight for number of messages.</span>
<span class="sd">            weight_similarity (float): Weight for model similarity.</span>
<span class="sd">            weight_fraction (float): Weight for fraction of parameters changed.</span>
<span class="sd">            weight_model_arrival_latency (float): Weight for model arrival latency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">static_weights</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_messages&quot;</span><span class="p">:</span> <span class="n">weight_messages_number</span><span class="p">,</span>
            <span class="s2">&quot;model_similarity&quot;</span><span class="p">:</span> <span class="n">weight_similarity</span><span class="p">,</span>
            <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">:</span> <span class="n">weight_fraction</span><span class="p">,</span>
            <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span> <span class="n">weight_model_arrival_latency</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">metric_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_messages&quot;</span><span class="p">:</span> <span class="n">metric_messages_number</span><span class="p">,</span>
            <span class="s2">&quot;model_similarity&quot;</span><span class="p">:</span> <span class="n">metric_similarity</span><span class="p">,</span>
            <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">:</span> <span class="n">metric_fraction</span><span class="p">,</span>
            <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span> <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">reputation_static</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="n">metric_values</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">*</span> <span class="n">static_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">static_weights</span>
        <span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Static reputation for node </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2"> at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">reputation_static</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation_static</span><span class="p">)</span>

        <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;addr&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span>
            <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
            <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
            <span class="s2">&quot;reputation_without_feedback&quot;</span><span class="p">:</span> <span class="n">avg_reputation</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_values</span><span class="p">:</span>
            <span class="n">metrics_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;average_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">static_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_update_reputation_record</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="n">avg_reputation</span><span class="p">,</span> <span class="n">metrics_data</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_dynamic_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the dynamic reputation of a participant based on historical metric data.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The address of the current node.</span>
<span class="sd">            neighbors (list): List of neighbor node addresses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: Updated dynamic reputation values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">average_weights</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">valid_entries</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">entry</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="ow">and</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;weight&quot;</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="n">valid_entries</span><span class="p">:</span>
                    <span class="n">average_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">entry</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">valid_entries</span><span class="p">])</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_entries</span><span class="p">)</span>
                    <span class="n">average_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">average_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="n">metric_values</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="k">if</span> <span class="p">(</span>
                            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>
                            <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span>
                            <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;nei&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nei</span>
                        <span class="p">):</span>
                            <span class="n">metric_values</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span>
                            <span class="k">break</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_values</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">average_weights</span><span class="p">):</span>
                <span class="n">reputation_with_weights</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span>
                    <span class="n">metric_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">average_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">average_weights</span>
                <span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Dynamic reputation with weights for </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2"> at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">reputation_with_weights</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

                <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation_with_weights</span><span class="p">)</span>

                <span class="n">metrics_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;addr&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span>
                    <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="s2">&quot;reputation_without_feedback&quot;</span><span class="p">:</span> <span class="n">avg_reputation</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">metric_values</span><span class="p">:</span>
                    <span class="n">metrics_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;average_</span><span class="si">{</span><span class="n">metric_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_update_reputation_record</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="n">avg_reputation</span><span class="p">,</span> <span class="n">metrics_data</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_update_reputation_record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the reputation record of a neighbor.</span>

<span class="sd">        Args:</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            reputation (float): The computed reputation value.</span>
<span class="sd">            data (dict): Additional metrics data associated with the reputation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">nei</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">reputation</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="s2">&quot;last_feedback_round&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reputation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reputation of node </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s1">&#39;reputation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rejected node </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2"> at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_weighted_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
        <span class="n">similarity_reputation</span><span class="p">,</span>
        <span class="n">fraction_score_asign</span><span class="p">,</span>
        <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
        <span class="n">history_data</span><span class="p">,</span>
        <span class="n">current_round</span><span class="p">,</span>
        <span class="n">addr</span><span class="p">,</span>
        <span class="n">nei</span><span class="p">,</span>
        <span class="n">reputation_metrics</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the weighted values for each metric based on current measurements and historical data.</span>

<span class="sd">        Args:</span>
<span class="sd">            avg_messages_number_message_normalized (float): Normalized average message count.</span>
<span class="sd">            similarity_reputation (float): Reputation score based on model similarity.</span>
<span class="sd">            fraction_score_asign (float): Score assigned from fraction of parameters changed.</span>
<span class="sd">            avg_model_arrival_latency (float): Average model arrival latency.</span>
<span class="sd">            history_data (dict): Historical metrics data.</span>
<span class="sd">            current_round (int): The current round number.</span>
<span class="sd">            addr (str): The address of the current node.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            reputation_metrics (dict): Dictionary indicating which metrics are active.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;num_messages&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span>
            <span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">:</span>
                    <span class="n">history_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;num_messages&quot;</span><span class="p">:</span> <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
                <span class="s2">&quot;model_similarity&quot;</span><span class="p">:</span> <span class="n">similarity_reputation</span><span class="p">,</span>
                <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">:</span> <span class="n">fraction_score_asign</span><span class="p">,</span>
                <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span> <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">active_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">False</span><span class="p">)}</span>
            <span class="n">num_active_metrics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_metrics</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
                    <span class="s2">&quot;addr&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span>
                    <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
                    <span class="s2">&quot;metric_name&quot;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                    <span class="s2">&quot;metric_value&quot;</span><span class="p">:</span> <span class="n">current_value</span><span class="p">,</span>
                    <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">})</span>

            <span class="n">adjusted_weights</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">num_active_metrics</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">desviations</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">historical_values</span> <span class="o">=</span> <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

                    <span class="n">metric_values</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">historical_values</span>
                        <span class="k">if</span> <span class="s2">&quot;metric_value&quot;</span> <span class="ow">in</span> <span class="n">entry</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
                    <span class="p">]</span>

                    <span class="k">if</span> <span class="n">metric_values</span><span class="p">:</span>
                        <span class="n">mean_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metric_values</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">mean_value</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">deviation</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">mean_value</span><span class="p">)</span>
                    <span class="n">desviations</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deviation</span>

                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">deviation</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">deviation</span> <span class="ow">in</span> <span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">random_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_active_metrics</span><span class="p">)]</span>
                    <span class="n">total_random_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">random_weights</span><span class="p">)</span>
                    <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">metric_name</span><span class="p">:</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">total_random_weight</span>
                        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">active_metrics</span><span class="p">,</span> <span class="n">random_weights</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">max_desviation</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">desviations</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">metric_name</span><span class="p">:</span> <span class="p">(</span><span class="n">desviation</span> <span class="o">/</span> <span class="n">max_desviation</span><span class="p">)</span> <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">desviation</span> <span class="ow">in</span> <span class="n">desviations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>

                    <span class="n">total_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">normalized_weights</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">total_weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="n">metric_name</span><span class="p">:</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">total_weight</span> <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">normalized_weights</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                        <span class="p">}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">num_active_metrics</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="p">}</span>

                <span class="n">mean_deviation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                <span class="n">dynamic_min_weight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mean_deviation</span> <span class="o">/</span> <span class="p">(</span><span class="n">mean_deviation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

                <span class="n">total_adjusted_weight</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">normalized_weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">dynamic_min_weight</span><span class="p">:</span>
                        <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamic_min_weight</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
                    <span class="n">total_adjusted_weight</span> <span class="o">+=</span> <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">total_adjusted_weight</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">adjusted_weights</span><span class="p">:</span>
                        <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_adjusted_weight</span>
                    <span class="n">total_adjusted_weight</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">adjusted_weights</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">num_active_metrics</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="p">}</span>

            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">weight</span> <span class="o">=</span> <span class="n">adjusted_weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_round</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;nei&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nei</span><span class="p">:</span>
                        <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">calculate_value_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">id_node</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">metrics_active</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate various metrics (message count, model similarity, fraction of parameters changed, and model arrival latency)</span>
<span class="sd">        for a given neighbor node based on stored connection data.</span>

<span class="sd">        Args:</span>
<span class="sd">            log_dir (str): Directory for log files.</span>
<span class="sd">            id_node (str): Identifier for the node.</span>
<span class="sd">            addr (str): The address of the current node.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            metrics_active (dict): Dictionary indicating which metrics are active.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple containing:</span>
<span class="sd">                - avg_messages_number_message_normalized (float)</span>
<span class="sd">                - similarity_reputation (float)</span>
<span class="sd">                - fraction_score_asign (float)</span>
<span class="sd">                - avg_model_arrival_latency (float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages_number_message_normalized</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fraction_score_normalized</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fraction_neighbors_scores</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>

            <span class="n">metrics_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics_instance</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">(</span>
                    <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
                    <span class="n">similarity_reputation</span><span class="p">,</span>
                    <span class="n">fraction_score_asign</span><span class="p">,</span>
                    <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">filtered_messages</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">msg</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">messages</span> <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_round&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span>
                <span class="p">]</span>
                <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">filtered_messages</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;number_message&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_round&quot;</span><span class="p">),</span>
                        <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">),</span>
                    <span class="p">})</span>

                <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_metric_number_message</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="kc">True</span>
                <span class="p">)</span>
                <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_number_message_history</span><span class="p">(</span>
                    <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">avg_messages_number_message_normalized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span>
                        <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
                    <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">)</span>
                    <span class="n">threshold</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">)</span>
                    <span class="n">fraction_score_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_anomalies</span><span class="p">(</span>
                        <span class="n">addr</span><span class="p">,</span>
                        <span class="n">nei</span><span class="p">,</span>
                        <span class="n">current_round</span><span class="p">,</span>
                        <span class="n">current_round</span><span class="p">,</span>  <span class="c1"># Assumes round_received is the current round.</span>
                        <span class="n">fraction_changed</span><span class="p">,</span>
                        <span class="n">threshold</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round_received&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
                    <span class="n">round_latency</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>
                    <span class="n">latency</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency&quot;</span><span class="p">)</span>
                    <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_model_arrival_latency</span><span class="p">(</span>
                        <span class="n">round_latency</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">current_round</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_similarity_from_metrics</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_model_arrival_latency_history</span><span class="p">(</span>
                    <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_model_arrival_latency_normalized</span><span class="p">,</span> <span class="n">current_round</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">avg_model_arrival_latency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span>
                        <span class="s2">&quot;score&quot;</span>
                    <span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_metric_number_message</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_number_message_history</span><span class="p">(</span>
                    <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">avg_messages_number_message_normalized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                    <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span>
                        <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fraction_score_normalized</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">key_previous_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">key_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key_previous_round</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                        <span class="n">fraction_score_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key_previous_round</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                        <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="n">fraction_score_prev</span> <span class="k">if</span> <span class="n">fraction_score_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">fraction_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_score_normalized</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">fraction_previous_round</span> <span class="o">*</span> <span class="mf">0.2</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)][</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">fraction_score_asign</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_score_normalized</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)][</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">fraction_score_asign</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">key_previous_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">key_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key_previous_round</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                        <span class="n">fraction_score_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key_previous_round</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                        <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="n">fraction_score_prev</span> <span class="k">if</span> <span class="n">fraction_score_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                    <span class="k">if</span> <span class="n">fraction_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_previous_round</span> <span class="o">-</span> <span class="p">(</span><span class="n">fraction_previous_round</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">fraction_neighbors_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">fraction_neighbors_scores</span> <span class="o">=</span> <span class="p">{}</span>

                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">score</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">fraction_neighbors_scores</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

                        <span class="k">if</span> <span class="n">fraction_neighbors_scores</span><span class="p">:</span>
                            <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fraction_neighbors_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">create_graphics_to_metrics</span><span class="p">(</span>
                <span class="n">messages_number_message_count</span><span class="p">,</span>
                <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
                <span class="n">similarity_reputation</span><span class="p">,</span>
                <span class="n">fraction_score_asign</span><span class="p">,</span>
                <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
                <span class="n">addr</span><span class="p">,</span>
                <span class="n">nei</span><span class="p">,</span>
                <span class="n">current_round</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">total_rounds</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span>
                <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
                <span class="n">similarity_reputation</span><span class="p">,</span>
                <span class="n">fraction_score_asign</span><span class="p">,</span>
                <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating reputation. Type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_graphics_to_metrics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">number_message_count</span><span class="p">,</span>
        <span class="n">number_message_norm</span><span class="p">,</span>
        <span class="n">similarity</span><span class="p">,</span>
        <span class="n">fraction</span><span class="p">,</span>
        <span class="n">model_arrival_latency</span><span class="p">,</span>
        <span class="n">addr</span><span class="p">,</span>
        <span class="n">nei</span><span class="p">,</span>
        <span class="n">current_round</span><span class="p">,</span>
        <span class="n">total_rounds</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and log graphics representing different metric values over the rounds.</span>

<span class="sd">        Args:</span>
<span class="sd">            number_message_count (int): Count of messages.</span>
<span class="sd">            number_message_norm (float): Normalized number of messages.</span>
<span class="sd">            similarity (float): Similarity metric value.</span>
<span class="sd">            fraction (float): Fraction score metric.</span>
<span class="sd">            model_arrival_latency (float): Latency metric score.</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            current_round (int): The current round number.</span>
<span class="sd">            total_rounds (int): Total rounds in the session.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">current_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&lt;</span> <span class="n">total_rounds</span><span class="p">:</span>
            <span class="n">model_arrival_latency_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Model_arrival_latency_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">model_arrival_latency</span><span class="p">}}</span>
            <span class="n">messages_number_message_count_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;R-Count_messages_number_message_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">number_message_count</span><span class="p">}</span>
            <span class="p">}</span>
            <span class="n">messages_number_message_norm_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-number_message_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">number_message_norm</span><span class="p">}}</span>
            <span class="n">similarity_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Similarity_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">similarity</span><span class="p">}}</span>
            <span class="n">fraction_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Fraction_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">fraction</span><span class="p">}}</span>

            <span class="k">if</span> <span class="n">messages_number_message_count_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">messages_number_message_count_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">messages_number_message_norm_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">messages_number_message_norm_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">similarity_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">similarity_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">fraction_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">fraction_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">model_arrival_latency_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">model_arrival_latency_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_anomalies</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addr</span><span class="p">,</span>
        <span class="n">nei</span><span class="p">,</span>
        <span class="n">round_num</span><span class="p">,</span>
        <span class="n">current_round</span><span class="p">,</span>
        <span class="n">fraction_changed</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze anomalies in the fraction of parameters changed and calculate a corresponding score.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The source node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            round_num (int): The round number for the metric.</span>
<span class="sd">            current_round (int): The current round number.</span>
<span class="sd">            fraction_changed (float): Fraction of parameters changed.</span>
<span class="sd">            threshold (float): Threshold value for changes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: A normalized fraction score between 0 and 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                <span class="n">prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prev_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                    <span class="n">previous_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">]</span>
                    <span class="n">fraction_changed</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">fraction_changed</span> <span class="k">if</span> <span class="n">fraction_changed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">previous_data</span><span class="p">[</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">previous_data</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">fraction_changed</span> <span class="k">if</span> <span class="n">fraction_changed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
                    <span class="s2">&quot;fraction_score&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;fraction_anomaly&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;threshold_anomaly&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="s2">&quot;mean_fraction&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;mean_threshold&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="p">}</span>

            <span class="k">if</span> <span class="n">round_num</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">past_fractions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">past_thresholds</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">round_num</span><span class="p">):</span>
                    <span class="n">past_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">past_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                        <span class="n">past_fractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">past_key</span><span class="p">][</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">])</span>
                        <span class="n">past_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">past_key</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">])</span>

                <span class="k">if</span> <span class="n">past_fractions</span><span class="p">:</span>
                    <span class="n">mean_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">past_fractions</span><span class="p">)</span>
                    <span class="n">std_dev_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">past_fractions</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_fraction</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_dev_fraction</span>

                <span class="k">if</span> <span class="n">past_thresholds</span><span class="p">:</span>
                    <span class="n">mean_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">past_thresholds</span><span class="p">)</span>
                    <span class="n">std_dev_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">past_thresholds</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_threshold</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_dev_threshold</span>

                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fraction_value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">threshold_value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">prev_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">potential_prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">potential_prev_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                            <span class="n">mean_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">potential_prev_key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">prev_key</span> <span class="o">=</span> <span class="n">potential_prev_key</span>
                                <span class="k">break</span>

                <span class="k">if</span> <span class="n">prev_key</span><span class="p">:</span>
                    <span class="n">mean_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span>
                    <span class="n">std_dev_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span>
                    <span class="n">mean_threshold_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span>
                    <span class="n">std_dev_threshold_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span>

                    <span class="n">current_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">]</span>
                    <span class="n">current_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>

                    <span class="n">upper_mean_fraction_prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_fraction_prev</span> <span class="o">+</span> <span class="n">std_dev_fraction_prev</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span>
                    <span class="n">upper_mean_threshold_prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_threshold_prev</span> <span class="o">+</span> <span class="n">std_dev_threshold_prev</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.10</span>

                    <span class="n">fraction_anomaly</span> <span class="o">=</span> <span class="n">current_fraction</span> <span class="o">&gt;</span> <span class="n">upper_mean_fraction_prev</span>
                    <span class="n">threshold_anomaly</span> <span class="o">=</span> <span class="n">current_threshold</span> <span class="o">&gt;</span> <span class="n">upper_mean_threshold_prev</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;fraction_anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fraction_anomaly</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;threshold_anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">threshold_anomaly</span>

                    <span class="n">penalization_factor_fraction</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="n">current_fraction</span> <span class="o">-</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_fraction_prev</span>
                        <span class="k">if</span> <span class="n">mean_fraction_prev</span> <span class="o">!=</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="mi">1</span>
                    <span class="p">)</span>
                    <span class="n">penalization_factor_threshold</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">abs</span><span class="p">(</span><span class="n">current_threshold</span> <span class="o">-</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_threshold_prev</span>
                        <span class="k">if</span> <span class="n">mean_threshold_prev</span> <span class="o">!=</span> <span class="mi">0</span>
                        <span class="k">else</span> <span class="mi">1</span>
                    <span class="p">)</span>

                    <span class="n">k_fraction</span> <span class="o">=</span> <span class="n">penalization_factor_fraction</span> <span class="k">if</span> <span class="n">penalization_factor_fraction</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
                    <span class="n">k_threshold</span> <span class="o">=</span> <span class="n">penalization_factor_threshold</span> <span class="k">if</span> <span class="n">penalization_factor_threshold</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

                    <span class="k">if</span> <span class="n">fraction_anomaly</span><span class="p">:</span>
                        <span class="n">fraction_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_fraction</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="n">current_fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fraction_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k_fraction</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="n">current_fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>

                    <span class="k">if</span> <span class="n">threshold_anomaly</span><span class="p">:</span>
                        <span class="n">threshold_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_threshold</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="n">current_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_threshold_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">threshold_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k_threshold</span><span class="p">)))</span>
                            <span class="k">if</span> <span class="n">current_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_threshold_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                            <span class="k">else</span> <span class="mi">0</span>
                        <span class="p">)</span>

                    <span class="n">fraction_weight</span> <span class="o">=</span> <span class="mf">0.5</span>
                    <span class="n">threshold_weight</span> <span class="o">=</span> <span class="mf">0.5</span>

                    <span class="n">fraction_score</span> <span class="o">=</span> <span class="n">fraction_weight</span> <span class="o">*</span> <span class="n">fraction_value</span> <span class="o">+</span> <span class="n">threshold_weight</span> <span class="o">*</span> <span class="n">threshold_value</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_fraction</span> <span class="o">+</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                        <span class="p">((</span><span class="n">current_fraction</span> <span class="o">-</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">std_dev_fraction_prev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_threshold</span> <span class="o">+</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                        <span class="p">((</span><span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">current_threshold</span> <span class="o">-</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">std_dev_threshold_prev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="p">)</span>

                    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">fraction_score</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error analyzing anomalies&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">manage_model_arrival_latency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manage the model arrival latency metric and normalize it based on historical latencies.</span>

<span class="sd">        Args:</span>
<span class="sd">            round_num (int): The round number when the model was sent.</span>
<span class="sd">            addr (str): The address of the current node.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            latency (float): The measured latency.</span>
<span class="sd">            current_round (int): The current round number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Normalized latency score between 0 and 1.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_key</span> <span class="o">=</span> <span class="n">nei</span>

            <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">prev_mean_latency</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">prev_percentil_0</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">prev_percentil_25</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">all_latencies</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;latency&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="s2">&quot;latency&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;latency&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
                <span class="p">]</span>

                <span class="n">prev_mean_latency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">prev_percentil_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">prev_percentil_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>

                <span class="n">k</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="n">prev_mean_latency</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_percentil_25</span> <span class="o">-</span> <span class="n">prev_percentil_0</span><span class="p">)</span>

                <span class="n">difference</span> <span class="o">=</span> <span class="n">latency</span> <span class="o">-</span> <span class="n">prev_mean_latency</span>
                <span class="k">if</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="n">prev_mean_latency</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_mean_latency</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">round_num</span> <span class="o">&lt;</span> <span class="n">current_round</span><span class="p">:</span>
                    <span class="n">round_diff</span> <span class="o">=</span> <span class="n">current_round</span> <span class="o">-</span> <span class="n">round_num</span>
                    <span class="n">penalty_factor</span> <span class="o">=</span> <span class="n">round_diff</span> <span class="o">*</span> <span class="mf">0.1</span>
                    <span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">score</span><span class="p">)</span>
                    <span class="n">score</span> <span class="o">-=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">score</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="s2">&quot;mean_latency&quot;</span><span class="p">:</span> <span class="n">prev_mean_latency</span><span class="p">,</span>
                    <span class="s2">&quot;percentil_0&quot;</span><span class="p">:</span> <span class="n">prev_percentil_0</span><span class="p">,</span>
                    <span class="s2">&quot;percentil_25&quot;</span><span class="p">:</span> <span class="n">prev_percentil_25</span><span class="p">,</span>
                    <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">return</span> <span class="n">score</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error managing model_arrival_latency: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_model_arrival_latency_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">model_arrival_latency</span><span class="p">,</span> <span class="n">round_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save and update the model arrival latency history in memory.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            model_arrival_latency (float): The normalized latency score.</span>
<span class="sd">            round_num (int): The current round number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The updated average model arrival latency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_key</span> <span class="o">=</span> <span class="n">nei</span>

            <span class="k">if</span> <span class="n">round_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">if</span> <span class="n">current_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">model_arrival_latency</span><span class="p">,</span>
            <span class="p">})</span>

            <span class="k">if</span> <span class="n">model_arrival_latency</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_key</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">model_arrival_latency</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.2</span>
                        <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="n">model_arrival_latency</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">model_arrival_latency</span> <span class="o">-</span> <span class="p">(</span><span class="n">model_arrival_latency</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model_arrival_latency</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_key</span><span class="p">,</span> <span class="p">{})</span>
                    <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">previous_avg</span> <span class="o">-</span> <span class="p">(</span><span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">model_arrival_latency</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">][</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">avg_model_arrival_latency</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">avg_model_arrival_latency</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving model_arrival_latency history&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">manage_metric_number_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">metric_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manage and normalize the number of messages metric using percentiles.</span>

<span class="sd">        Args:</span>
<span class="sd">            messages_number_message (list): List containing message data.</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            current_round (int): The current round number.</span>
<span class="sd">            metric_active (bool): Flag indicating whether the metric is active.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: A tuple with the normalized number_message value (float) and the count of messages (int).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">current_round</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">metric_active</span><span class="p">:</span>
                <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">previous_round</span> <span class="o">=</span> <span class="n">current_round</span>

            <span class="n">current_addr_nei</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>
            <span class="n">relevant_messages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">msg</span>
                <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages_number_message</span>
                <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_addr_nei</span> <span class="ow">and</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;current_round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">previous_round</span>
            <span class="p">]</span>
            <span class="n">messages_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_messages</span><span class="p">)</span> <span class="k">if</span> <span class="n">relevant_messages</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">previous_round</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_round</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">previous_counts</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">len</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages_number_message</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_addr_nei</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;current_round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rounds_to_consider</span>
            <span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span><span class="p">[</span><span class="n">current_addr_nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">previous_counts</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="n">previous_counts</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span><span class="p">[</span><span class="n">current_addr_nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">previous_counts</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span> <span class="k">if</span> <span class="n">previous_counts</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>

            <span class="n">normalized_messages</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">relative_position</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">previous_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">percentile_25</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_addr_nei</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">percentile_85</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_addr_nei</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">messages_count</span> <span class="o">&gt;</span> <span class="n">percentile_85</span><span class="p">:</span>
                    <span class="n">relative_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">messages_count</span> <span class="o">-</span> <span class="n">percentile_85</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">percentile_85</span> <span class="o">-</span> <span class="n">percentile_25</span><span class="p">)</span>
                    <span class="n">normalized_messages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative_position</span><span class="p">)</span>

                <span class="n">normalized_messages</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalized_messages</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">normalized_messages</span><span class="p">,</span> <span class="n">messages_count</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error managing metric number_message&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_number_message_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the normalized number_message history in memory and calculate a weighted average.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            messages_number_message_normalized (float): The normalized number_message value.</span>
<span class="sd">            current_round (int): The current round number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The weighted average of the number_message metric.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>
            <span class="n">avg_number_message</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_message&quot;</span><span class="p">:</span> <span class="n">messages_number_message_normalized</span><span class="p">}</span>

            <span class="k">if</span> <span class="n">messages_number_message_normalized</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">avg_number_message</span> <span class="o">=</span> <span class="n">messages_number_message_normalized</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.2</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">avg_number_message</span> <span class="o">=</span> <span class="n">messages_number_message_normalized</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_number_message</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_number_message</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">return</span> <span class="n">avg_number_message</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving number_message history&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error managing model_arrival_latency latency: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Save the reputation history for a neighbor and compute an average reputation.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            reputation (float): The computed reputation for the current round.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The updated (weighted) reputation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reputation</span>

            <span class="n">avg_reputation</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>
            <span class="n">rounds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rounds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">current_round</span> <span class="o">=</span> <span class="n">rounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">previous_round</span> <span class="o">=</span> <span class="n">rounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="n">current_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span>
                <span class="n">previous_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">previous_round</span><span class="p">]</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current reputation: </span><span class="si">{</span><span class="n">current_rep</span><span class="si">}</span><span class="s2">, Previous reputation: </span><span class="si">{</span><span class="n">previous_rep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">avg_reputation</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_rep</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">previous_rep</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reputation ponderated: </span><span class="si">{</span><span class="n">avg_reputation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">avg_reputation</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving reputation history&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_decay_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reputation</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the decay rate for a given reputation value.</span>

<span class="sd">        Args:</span>
<span class="sd">            reputation (float): The current reputation value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The decay rate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.9</span>  <span class="c1"># Very low decay</span>
        <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.8</span>  <span class="c1"># Medium decay</span>
        <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.6</span>  <span class="c1"># Low decay</span>
        <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.2</span>  <span class="c1"># High decay</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.1</span>  <span class="c1"># Very high decay</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_similarity_from_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the similarity score based on stored similarity metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            nei (str): The neighbor node&#39;s address.</span>
<span class="sd">            current_round (int): The current round number.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The aggregated similarity score.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">similarity_value</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">metrics_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">metrics_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics instance found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">similarity_value</span>

        <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
            <span class="n">source_ip</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nei&quot;</span><span class="p">)</span>
            <span class="n">round_in_metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">source_ip</span> <span class="o">==</span> <span class="n">nei</span> <span class="ow">and</span> <span class="n">round_in_metric</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
                <span class="n">weight_cosine</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">weight_euclidean</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">weight_manhattan</span> <span class="o">=</span> <span class="mf">0.25</span>
                <span class="n">weight_pearson</span> <span class="o">=</span> <span class="mf">0.25</span>

                <span class="n">cosine</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">euclidean</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">manhattan</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manhattan&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
                <span class="n">pearson_correlation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pearson_correlation&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

                <span class="n">similarity_value</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">weight_cosine</span> <span class="o">*</span> <span class="n">cosine</span>
                    <span class="o">+</span> <span class="n">weight_euclidean</span> <span class="o">*</span> <span class="n">euclidean</span>
                    <span class="o">+</span> <span class="n">weight_manhattan</span> <span class="o">*</span> <span class="n">manhattan</span>
                    <span class="o">+</span> <span class="n">weight_pearson</span> <span class="o">*</span> <span class="n">pearson_correlation</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">similarity_value</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">calculate_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ae</span><span class="p">:</span> <span class="n">AggregationEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate and update the reputation for all neighbor nodes based on active metrics.</span>

<span class="sd">        This method processes the aggregated updates and then, based on the selected weighting factor (static or dynamic),</span>
<span class="sd">        calculates the reputation. It also includes feedback and sends the reputation scores to neighbors.</span>

<span class="sd">        Args:</span>
<span class="sd">            ae (AggregationEvent): The event containing aggregated updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">updates</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ae</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active metrics: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected nodes at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">_cm</span><span class="o">.</span><span class="n">get_addrs_current_connections</span><span class="p">(</span><span class="n">only_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">history_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span>

            <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
                <span class="p">(</span>
                    <span class="n">metric_messages_number</span><span class="p">,</span>
                    <span class="n">metric_similarity</span><span class="p">,</span>
                    <span class="n">metric_fraction</span><span class="p">,</span>
                    <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
                <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_value_metrics</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">nei</span><span class="p">,</span>
                    <span class="n">metrics_active</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">calculate_weighted_values</span><span class="p">(</span>
                        <span class="n">metric_messages_number</span><span class="p">,</span>
                        <span class="n">metric_similarity</span><span class="p">,</span>
                        <span class="n">metric_fraction</span><span class="p">,</span>
                        <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
                        <span class="n">history_data</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                        <span class="n">nei</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_static_reputation</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                        <span class="n">nei</span><span class="p">,</span>
                        <span class="n">metric_messages_number</span><span class="p">,</span>
                        <span class="n">metric_similarity</span><span class="p">,</span>
                        <span class="n">metric_fraction</span><span class="p">,</span>
                        <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dynamic_reputation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
                <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;network_args&quot;</span><span class="p">][</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">init_reputation</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">federation_nodes</span><span class="o">=</span><span class="n">federation</span><span class="p">,</span>
                    <span class="n">round_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="n">last_feedback_round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">init_reputation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_feedback_in_reputation</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feedback included in reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feedback not included in reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">create_graphic_reputation</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="p">)</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_process_aggregation</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_reputation_to_neighbors</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_reputation_to_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send the calculated reputation scores to all neighbors.</span>

<span class="sd">        Args:</span>
<span class="sd">            neighbors (iterable): An iterable of neighbor node addresses.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">nei</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">neighbors_to_send</span> <span class="o">=</span> <span class="p">[</span><span class="n">neighbor</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span> <span class="k">if</span> <span class="n">neighbor</span> <span class="o">!=</span> <span class="n">nei</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors_to_send</span><span class="p">:</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span>
                        <span class="s2">&quot;reputation&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;share&quot;</span><span class="p">,</span>
                        <span class="n">node_id</span><span class="o">=</span><span class="n">nei</span><span class="p">,</span>
                        <span class="n">score</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]),</span>
                        <span class="nb">round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="p">)</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">neighbor</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Sending reputation to node </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2"> from node </span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> with reputation </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;reputation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_graphic_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">round_num</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a graphical representation of the reputation scores and log the data.</span>

<span class="sd">        Args:</span>
<span class="sd">            addr (str): The current node&#39;s address.</span>
<span class="sd">            round_num (int): The current round number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">reputation_dict_with_values</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sa">f</span><span class="s2">&quot;Reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="n">node_id</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reputation dict: </span><span class="si">{</span><span class="n">reputation_dict_with_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">reputation_dict_with_values</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">round_num</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error creating reputation graphic&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_process_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">updates</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the aggregation process by removing nodes that have been rejected.</span>

<span class="sd">        Args:</span>
<span class="sd">            updates (dict): The dictionary of updates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">updates</span><span class="p">:</span>
                <span class="n">updates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updates after rejected nodes: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">updates</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected nodes after clear at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">include_feedback_in_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrate feedback scores into the current reputation values.</span>

<span class="sd">        The final reputation is computed as a weighted sum of the current reputation and the average feedback.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if feedback was successfully included, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">weight_current_reputation</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">weight_feedback</span> <span class="o">=</span> <span class="mf">0.1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No feedback received.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">current_node</span><span class="p">,</span> <span class="n">node_ip</span><span class="p">,</span> <span class="n">round_num</span><span class="p">),</span> <span class="n">scores</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">scores</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No feedback received for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">round_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">node_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No reputation for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;last_feedback_round&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span>
                <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">][</span><span class="s2">&quot;last_feedback_round&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">round_num</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">avg_feedback</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receive feedback to node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> with average score </span><span class="si">{</span><span class="n">avg_feedback</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">current_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">current_reputation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No reputation calculate for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">combined_reputation</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_reputation</span> <span class="o">*</span> <span class="n">weight_current_reputation</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">avg_feedback</span> <span class="o">*</span> <span class="n">weight_feedback</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combined reputation for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">round_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">combined_reputation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">combined_reputation</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="s2">&quot;last_feedback_round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated self.reputation for </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">updated</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_round_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rse</span><span class="p">:</span> <span class="n">RoundStartEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler for the start of a round. It stores the start time and updates the expected nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            rse (RoundStartEvent): The event data containing round start information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">round_id</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">expected_nodes</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rse</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">round_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">round_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">round_id</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="n">expected_nodes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_model_arrival_latency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler to record the model arrival latency when an update is received.</span>

<span class="sd">        Args:</span>
<span class="sd">            ure (UpdateReceivedEvent): The event data for a model update.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">current_round</span> <span class="o">=</span> <span class="n">round_num</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="s2">&quot;model_received_time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_time</span>

            <span class="k">if</span> <span class="s2">&quot;start_time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]:</span>
                <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
                <span class="n">received_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">received_time</span> <span class="o">-</span> <span class="n">start</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">duration</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> , round </span><span class="si">{</span><span class="n">current_round</span><span class="si">}</span><span class="s2">, duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
                    <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span>
                    <span class="n">source</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">num_round</span><span class="o">=</span><span class="n">current_round</span><span class="p">,</span>
                    <span class="n">current_round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="n">latency</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model arrival latency already calculated for node </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">current_round</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler to recollect and store model similarity metrics when an update is received.</span>

<span class="sd">        Args:</span>
<span class="sd">            ure (UpdateReceivedEvent): The event data containing model update information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;adaptive_args&quot;</span><span class="p">][</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">nei</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🤖  handle_model_message | Checking model similarity&quot;</span><span class="p">)</span>
                    <span class="n">cosine_value</span> <span class="o">=</span> <span class="n">cosine_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">euclidean_value</span> <span class="o">=</span> <span class="n">euclidean_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">minkowski_value</span> <span class="o">=</span> <span class="n">minkowski_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">manhattan_value</span> <span class="o">=</span> <span class="n">manhattan_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">pearson_correlation_value</span> <span class="o">=</span> <span class="n">pearson_correlation_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">jaccard_value</span> <span class="o">=</span> <span class="n">jaccard_metric</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                        <span class="n">decoded_model</span><span class="p">,</span>
                        <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">similarity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                        <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
                        <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
                        <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                        <span class="s2">&quot;cosine&quot;</span><span class="p">:</span> <span class="n">cosine_value</span><span class="p">,</span>
                        <span class="s2">&quot;euclidean&quot;</span><span class="p">:</span> <span class="n">euclidean_value</span><span class="p">,</span>
                        <span class="s2">&quot;minkowski&quot;</span><span class="p">:</span> <span class="n">minkowski_value</span><span class="p">,</span>
                        <span class="s2">&quot;manhattan&quot;</span><span class="p">:</span> <span class="n">manhattan_value</span><span class="p">,</span>
                        <span class="s2">&quot;pearson_correlation&quot;</span><span class="p">:</span> <span class="n">pearson_correlation_value</span><span class="p">,</span>
                        <span class="s2">&quot;jaccard&quot;</span><span class="p">:</span> <span class="n">jaccard_value</span><span class="p">,</span>
                    <span class="p">}</span>

                    <span class="k">if</span> <span class="n">nei</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">similarity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">similarity_metrics</span><span class="p">)</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored similarity metrics for </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">similarity_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics instance found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">cosine_value</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🤖  handle_model_message | Model similarity is less than 0.6&quot;</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_number_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler to collect message count metrics when a message is received.</span>

<span class="sd">        Args:</span>
<span class="sd">            source (str): The source node&#39;s address.</span>
<span class="sd">            message: The received message (content not used directly).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">source</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">current_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
                    <span class="s2">&quot;number_message&quot;</span><span class="p">,</span>
                    <span class="n">source</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">time</span><span class="o">=</span><span class="n">current_time</span><span class="p">,</span>
                    <span class="n">current_round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_fraction_of_parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Event handler to recollect the fraction of parameters changed when an update is received.</span>

<span class="sd">        Args:</span>
<span class="sd">            ure (UpdateReceivedEvent): The event data containing model update information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
        <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>
        <span class="n">parameters_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">()</span>
        <span class="n">parameters_received</span> <span class="o">=</span> <span class="n">decoded_model</span>
        <span class="n">differences</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">total_params</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">changed_params</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">changes_record</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prev_threshold</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]:</span>
            <span class="n">prev_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_local</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_received</span><span class="p">:</span>
                <span class="n">local_tensor</span> <span class="o">=</span> <span class="n">parameters_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
                <span class="n">received_tensor</span> <span class="o">=</span> <span class="n">parameters_received</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">local_tensor</span> <span class="o">-</span> <span class="n">received_tensor</span><span class="p">)</span>
                <span class="n">differences</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
                <span class="n">total_params</span> <span class="o">+=</span> <span class="n">diff</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">differences</span><span class="p">:</span>
            <span class="n">mean_threshold</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">differences</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">current_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_threshold</span> <span class="o">+</span> <span class="n">mean_threshold</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">prev_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mean_threshold</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">current_threshold</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_local</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_received</span><span class="p">:</span>
                <span class="n">local_tensor</span> <span class="o">=</span> <span class="n">parameters_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
                <span class="n">received_tensor</span> <span class="o">=</span> <span class="n">parameters_received</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">local_tensor</span> <span class="o">-</span> <span class="n">received_tensor</span><span class="p">)</span>
                <span class="n">num_changed</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">current_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">changed_params</span> <span class="o">+=</span> <span class="n">num_changed</span>
                <span class="k">if</span> <span class="n">num_changed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">changes_record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_changed</span>

        <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">changed_params</span> <span class="o">/</span> <span class="n">total_params</span> <span class="k">if</span> <span class="n">total_params</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
            <span class="s2">&quot;total_params&quot;</span><span class="p">:</span> <span class="n">total_params</span><span class="p">,</span>
            <span class="s2">&quot;changed_params&quot;</span><span class="p">:</span> <span class="n">changed_params</span><span class="p">,</span>
            <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">current_threshold</span><span class="p">,</span>
            <span class="s2">&quot;changes_record&quot;</span><span class="p">:</span> <span class="n">changes_record</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
            <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">,</span>
            <span class="n">source</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
            <span class="n">current_round</span><span class="p">,</span>
            <span class="n">fraction_changed</span><span class="o">=</span><span class="n">fraction_changed</span><span class="p">,</span>
            <span class="n">total_params</span><span class="o">=</span><span class="n">total_params</span><span class="p">,</span>
            <span class="n">changed_params</span><span class="o">=</span><span class="n">changed_params</span><span class="p">,</span>
            <span class="n">threshold</span><span class="o">=</span><span class="n">current_threshold</span><span class="p">,</span>
            <span class="n">changes_record</span><span class="o">=</span><span class="n">changes_record</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="nebula.addons.reputation.reputation.Reputation.engine" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">engine</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.engine" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Return the engine instance.</p>

    </div>

</div>



<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the Reputation system.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>engine</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Engine (nebula.core.engine.Engine)" href="../../../core/engine/#nebula.core.engine.Engine">Engine</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The engine instance providing the runtime context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>config</code>
            </td>
            <td>
                  <code><span title="nebula.config.config.Config">Config</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration object with participant settings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="s2">&quot;Engine&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="s2">&quot;Config&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the Reputation system.</span>

<span class="sd">    Args:</span>
<span class="sd">        engine (Engine): The engine instance providing the runtime context.</span>
<span class="sd">        config (Config): The configuration object with participant settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="n">engine</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_config</span> <span class="o">=</span> <span class="n">config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metric_weights</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_feedback</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_messages_received_from_sources</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">neighbor_reputation_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_threshold_number_message</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_std_dev_number_message</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">messages_model_arrival_latency</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">addr</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">log_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span> <span class="o">=</span> <span class="n">engine</span><span class="o">.</span><span class="n">idx</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">neighbors</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;network_args&quot;</span><span class="p">][</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Metrics</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;with_reputation&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;reputation_metrics&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;initial_reputation&quot;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weighting_factor&quot;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_model_arrival_latency&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_model_similarity&quot;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_num_messages&quot;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;defense_args&quot;</span><span class="p">][</span><span class="s2">&quot;weight_fraction_params_changed&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Reputation system: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Reputation metrics: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Initial reputation: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weighting factor: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight model arrival latency: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight model similarity: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight number of messages: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Weight fraction of parameters changed: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">print_msg_box</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Defense information&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.analyze_anomalies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">analyze_anomalies</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">fraction_changed</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.analyze_anomalies" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Analyze anomalies in the fraction of parameters changed and calculate a corresponding score.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The round number for the metric.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction_changed</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of parameters changed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold value for changes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A normalized fraction score between 0 and 1.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_anomalies</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">addr</span><span class="p">,</span>
    <span class="n">nei</span><span class="p">,</span>
    <span class="n">round_num</span><span class="p">,</span>
    <span class="n">current_round</span><span class="p">,</span>
    <span class="n">fraction_changed</span><span class="p">,</span>
    <span class="n">threshold</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze anomalies in the fraction of parameters changed and calculate a corresponding score.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The source node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        round_num (int): The round number for the metric.</span>
<span class="sd">        current_round (int): The current round number.</span>
<span class="sd">        fraction_changed (float): Fraction of parameters changed.</span>
<span class="sd">        threshold (float): Threshold value for changes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: A normalized fraction score between 0 and 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
            <span class="n">prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">prev_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                <span class="n">previous_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">]</span>
                <span class="n">fraction_changed</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">fraction_changed</span> <span class="k">if</span> <span class="n">fraction_changed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">previous_data</span><span class="p">[</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">previous_data</span><span class="p">[</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">fraction_changed</span> <span class="k">if</span> <span class="n">fraction_changed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="k">if</span> <span class="n">threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
                <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
                <span class="s2">&quot;fraction_score&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;fraction_anomaly&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;threshold_anomaly&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;mean_fraction&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;mean_threshold&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">round_num</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">past_fractions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">past_thresholds</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">round_num</span><span class="p">):</span>
                <span class="n">past_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">past_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                    <span class="n">past_fractions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">past_key</span><span class="p">][</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">])</span>
                    <span class="n">past_thresholds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">past_key</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">past_fractions</span><span class="p">:</span>
                <span class="n">mean_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">past_fractions</span><span class="p">)</span>
                <span class="n">std_dev_fraction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">past_fractions</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_fraction</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_dev_fraction</span>

            <span class="k">if</span> <span class="n">past_thresholds</span><span class="p">:</span>
                <span class="n">mean_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">past_thresholds</span><span class="p">)</span>
                <span class="n">std_dev_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">past_thresholds</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_threshold</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">std_dev_threshold</span>

            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fraction_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">threshold_value</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">prev_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">potential_prev_key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">potential_prev_key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                        <span class="n">mean_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">potential_prev_key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">prev_key</span> <span class="o">=</span> <span class="n">potential_prev_key</span>
                            <span class="k">break</span>

            <span class="k">if</span> <span class="n">prev_key</span><span class="p">:</span>
                <span class="n">mean_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span>
                <span class="n">std_dev_fraction_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span>
                <span class="n">mean_threshold_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span>
                <span class="n">std_dev_threshold_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">prev_key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span>

                <span class="n">current_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">]</span>
                <span class="n">current_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>

                <span class="n">upper_mean_fraction_prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_fraction_prev</span> <span class="o">+</span> <span class="n">std_dev_fraction_prev</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.05</span>
                <span class="n">upper_mean_threshold_prev</span> <span class="o">=</span> <span class="p">(</span><span class="n">mean_threshold_prev</span> <span class="o">+</span> <span class="n">std_dev_threshold_prev</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.10</span>

                <span class="n">fraction_anomaly</span> <span class="o">=</span> <span class="n">current_fraction</span> <span class="o">&gt;</span> <span class="n">upper_mean_fraction_prev</span>
                <span class="n">threshold_anomaly</span> <span class="o">=</span> <span class="n">current_threshold</span> <span class="o">&gt;</span> <span class="n">upper_mean_threshold_prev</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;fraction_anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fraction_anomaly</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;threshold_anomaly&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">threshold_anomaly</span>

                <span class="n">penalization_factor_fraction</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">current_fraction</span> <span class="o">-</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_fraction_prev</span>
                    <span class="k">if</span> <span class="n">mean_fraction_prev</span> <span class="o">!=</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="mi">1</span>
                <span class="p">)</span>
                <span class="n">penalization_factor_threshold</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">abs</span><span class="p">(</span><span class="n">current_threshold</span> <span class="o">-</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">/</span> <span class="n">mean_threshold_prev</span>
                    <span class="k">if</span> <span class="n">mean_threshold_prev</span> <span class="o">!=</span> <span class="mi">0</span>
                    <span class="k">else</span> <span class="mi">1</span>
                <span class="p">)</span>

                <span class="n">k_fraction</span> <span class="o">=</span> <span class="n">penalization_factor_fraction</span> <span class="k">if</span> <span class="n">penalization_factor_fraction</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">k_threshold</span> <span class="o">=</span> <span class="n">penalization_factor_threshold</span> <span class="k">if</span> <span class="n">penalization_factor_threshold</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">fraction_anomaly</span><span class="p">:</span>
                    <span class="n">fraction_value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_fraction</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">current_fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fraction_value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k_fraction</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">current_fraction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_fraction_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">threshold_anomaly</span><span class="p">:</span>
                    <span class="n">threshold_value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">k_threshold</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">current_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_threshold_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">threshold_value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">k_threshold</span><span class="p">)))</span>
                        <span class="k">if</span> <span class="n">current_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">mean_threshold_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="k">else</span> <span class="mi">0</span>
                    <span class="p">)</span>

                <span class="n">fraction_weight</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="n">threshold_weight</span> <span class="o">=</span> <span class="mf">0.5</span>

                <span class="n">fraction_score</span> <span class="o">=</span> <span class="n">fraction_weight</span> <span class="o">*</span> <span class="n">fraction_value</span> <span class="o">+</span> <span class="n">threshold_weight</span> <span class="o">*</span> <span class="n">threshold_value</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_fraction</span> <span class="o">+</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="p">((</span><span class="n">current_fraction</span> <span class="o">-</span> <span class="n">mean_fraction_prev</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">std_dev_fraction_prev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;mean_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_threshold</span> <span class="o">+</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;std_dev_threshold&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="p">((</span><span class="mf">0.1</span> <span class="o">*</span> <span class="p">(</span><span class="n">current_threshold</span> <span class="o">-</span> <span class="n">mean_threshold_prev</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">std_dev_threshold_prev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="p">)</span>

                <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">fraction_score</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error analyzing anomalies&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.calculate_decay_rate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_decay_rate</span><span class="p">(</span><span class="n">reputation</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.calculate_decay_rate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the decay rate for a given reputation value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reputation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current reputation value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The decay rate.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_decay_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reputation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the decay rate for a given reputation value.</span>

<span class="sd">    Args:</span>
<span class="sd">        reputation (float): The current reputation value.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The decay rate.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.9</span>  <span class="c1"># Very low decay</span>
    <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.8</span>  <span class="c1"># Medium decay</span>
    <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.6</span>  <span class="c1"># Low decay</span>
    <span class="k">elif</span> <span class="n">reputation</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.2</span>  <span class="c1"># High decay</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.1</span>  <span class="c1"># Very high decay</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.calculate_reputation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_reputation</span><span class="p">(</span><span class="n">ae</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.calculate_reputation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate and update the reputation for all neighbor nodes based on active metrics.</p>
<p>This method processes the aggregated updates and then, based on the selected weighting factor (static or dynamic),
calculates the reputation. It also includes feedback and sends the reputation scores to neighbors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ae</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="AggregationEvent (nebula.core.nebulaevents.AggregationEvent)" href="../../../core/nebulaevents/#nebula.core.nebulaevents.AggregationEvent">AggregationEvent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event containing aggregated updates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">calculate_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ae</span><span class="p">:</span> <span class="n">AggregationEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate and update the reputation for all neighbor nodes based on active metrics.</span>

<span class="sd">    This method processes the aggregated updates and then, based on the selected weighting factor (static or dynamic),</span>
<span class="sd">    calculates the reputation. It also includes feedback and sends the reputation scores to neighbors.</span>

<span class="sd">    Args:</span>
<span class="sd">        ae (AggregationEvent): The event containing aggregated updates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">updates</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ae</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculating reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Active metrics: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected nodes at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">neighbors</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">_cm</span><span class="o">.</span><span class="n">get_addrs_current_connections</span><span class="p">(</span><span class="n">only_direct</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="n">history_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">history_data</span>

        <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="p">(</span>
                <span class="n">metric_messages_number</span><span class="p">,</span>
                <span class="n">metric_similarity</span><span class="p">,</span>
                <span class="n">metric_fraction</span><span class="p">,</span>
                <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_value_metrics</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_dir</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_idx</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                <span class="n">nei</span><span class="p">,</span>
                <span class="n">metrics_active</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">calculate_weighted_values</span><span class="p">(</span>
                    <span class="n">metric_messages_number</span><span class="p">,</span>
                    <span class="n">metric_similarity</span><span class="p">,</span>
                    <span class="n">metric_fraction</span><span class="p">,</span>
                    <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
                    <span class="n">history_data</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">nei</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_static_reputation</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                    <span class="n">nei</span><span class="p">,</span>
                    <span class="n">metric_messages_number</span><span class="p">,</span>
                    <span class="n">metric_similarity</span><span class="p">,</span>
                    <span class="n">metric_fraction</span><span class="p">,</span>
                    <span class="n">metric_model_arrival_latency</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_num_messages</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_similarity</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_fraction_params_changed</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_weight_model_arrival_latency</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weighting_factor</span> <span class="o">==</span> <span class="s2">&quot;dynamic&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dynamic_reputation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
            <span class="n">federation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;network_args&quot;</span><span class="p">][</span><span class="s2">&quot;neighbors&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_reputation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                <span class="n">federation_nodes</span><span class="o">=</span><span class="n">federation</span><span class="p">,</span>
                <span class="n">round_num</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="n">last_feedback_round</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">init_reputation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_initial_reputation</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">include_feedback_in_reputation</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feedback included in reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Feedback not included in reputation at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_graphic_reputation</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
            <span class="p">)</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_process_aggregation</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_reputation_to_neighbors</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.calculate_similarity_from_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_similarity_from_metrics</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.calculate_similarity_from_metrics" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the similarity score based on stored similarity metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The aggregated similarity score.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_similarity_from_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the similarity score based on stored similarity metrics.</span>

<span class="sd">    Args:</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        current_round (int): The current round number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The aggregated similarity score.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">similarity_value</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">metrics_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metrics_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics instance found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">similarity_value</span>

    <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">similarity</span><span class="p">:</span>
        <span class="n">source_ip</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nei&quot;</span><span class="p">)</span>
        <span class="n">round_in_metric</span> <span class="o">=</span> <span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">source_ip</span> <span class="o">==</span> <span class="n">nei</span> <span class="ow">and</span> <span class="n">round_in_metric</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
            <span class="n">weight_cosine</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">weight_euclidean</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">weight_manhattan</span> <span class="o">=</span> <span class="mf">0.25</span>
            <span class="n">weight_pearson</span> <span class="o">=</span> <span class="mf">0.25</span>

            <span class="n">cosine</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">euclidean</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;euclidean&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">manhattan</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;manhattan&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">pearson_correlation</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">metric</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pearson_correlation&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

            <span class="n">similarity_value</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">weight_cosine</span> <span class="o">*</span> <span class="n">cosine</span>
                <span class="o">+</span> <span class="n">weight_euclidean</span> <span class="o">*</span> <span class="n">euclidean</span>
                <span class="o">+</span> <span class="n">weight_manhattan</span> <span class="o">*</span> <span class="n">manhattan</span>
                <span class="o">+</span> <span class="n">weight_pearson</span> <span class="o">*</span> <span class="n">pearson_correlation</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">similarity_value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.calculate_value_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_value_metrics</span><span class="p">(</span><span class="n">log_dir</span><span class="p">,</span> <span class="n">id_node</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">metrics_active</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.calculate_value_metrics" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate various metrics (message count, model similarity, fraction of parameters changed, and model arrival latency)
for a given neighbor node based on stored connection data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>log_dir</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory for log files.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>id_node</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Identifier for the node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The address of the current node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metrics_active</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary indicating which metrics are active.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- avg_messages_number_message_normalized (float)
- similarity_reputation (float)
- fraction_score_asign (float)
- avg_model_arrival_latency (float)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">calculate_value_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">,</span> <span class="n">id_node</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">metrics_active</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate various metrics (message count, model similarity, fraction of parameters changed, and model arrival latency)</span>
<span class="sd">    for a given neighbor node based on stored connection data.</span>

<span class="sd">    Args:</span>
<span class="sd">        log_dir (str): Directory for log files.</span>
<span class="sd">        id_node (str): Identifier for the node.</span>
<span class="sd">        addr (str): The address of the current node.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        metrics_active (dict): Dictionary indicating which metrics are active.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - avg_messages_number_message_normalized (float)</span>
<span class="sd">            - similarity_reputation (float)</span>
<span class="sd">            - fraction_score_asign (float)</span>
<span class="sd">            - avg_model_arrival_latency (float)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">messages_number_message_normalized</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fraction_score_normalized</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fraction_neighbors_scores</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>

        <span class="n">metrics_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">metrics_instance</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
                <span class="n">similarity_reputation</span><span class="p">,</span>
                <span class="n">fraction_score_asign</span><span class="p">,</span>
                <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">filtered_messages</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">msg</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">messages</span> <span class="k">if</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_round&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">filtered_messages</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s2">&quot;number_message&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="n">msg</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_round&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">),</span>
                <span class="p">})</span>

            <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_metric_number_message</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_number_message_history</span><span class="p">(</span>
                <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">avg_messages_number_message_normalized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span>
                    <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
                <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_changed&quot;</span><span class="p">)</span>
                <span class="n">threshold</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;threshold&quot;</span><span class="p">)</span>
                <span class="n">fraction_score_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_anomalies</span><span class="p">(</span>
                    <span class="n">addr</span><span class="p">,</span>
                    <span class="n">nei</span><span class="p">,</span>
                    <span class="n">current_round</span><span class="p">,</span>
                    <span class="n">current_round</span><span class="p">,</span>  <span class="c1"># Assumes round_received is the current round.</span>
                    <span class="n">fraction_changed</span><span class="p">,</span>
                    <span class="n">threshold</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round_received&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">current_round</span><span class="p">:</span>
                <span class="n">round_latency</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">)</span>
                <span class="n">latency</span> <span class="o">=</span> <span class="n">metrics_instance</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;latency&quot;</span><span class="p">)</span>
                <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_model_arrival_latency</span><span class="p">(</span>
                    <span class="n">round_latency</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">current_round</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_similarity_from_metrics</span><span class="p">(</span><span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">similarity_reputation</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">messages_model_arrival_latency_normalized</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_model_arrival_latency_history</span><span class="p">(</span>
                <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_model_arrival_latency_normalized</span><span class="p">,</span> <span class="n">current_round</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">avg_model_arrival_latency</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span>
                    <span class="s2">&quot;score&quot;</span>
                <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">messages_number_message_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">manage_metric_number_message</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">metrics_active</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_number_message_history</span><span class="p">(</span>
                <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">avg_messages_number_message_normalized</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
                <span class="n">avg_messages_number_message_normalized</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)][</span>
                    <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fraction_score_normalized</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">key_previous_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">key_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key_previous_round</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                    <span class="n">fraction_score_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key_previous_round</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                    <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="n">fraction_score_prev</span> <span class="k">if</span> <span class="n">fraction_score_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">fraction_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_score_normalized</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">fraction_previous_round</span> <span class="o">*</span> <span class="mf">0.2</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)][</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">fraction_score_asign</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_score_normalized</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)][</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">fraction_score_asign</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">key_previous_round</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">key_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">key_previous_round</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">:</span>
                    <span class="n">fraction_score_prev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="p">[</span><span class="n">key_previous_round</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                    <span class="n">fraction_previous_round</span> <span class="o">=</span> <span class="n">fraction_score_prev</span> <span class="k">if</span> <span class="n">fraction_score_prev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">fraction_previous_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">fraction_previous_round</span> <span class="o">-</span> <span class="p">(</span><span class="n">fraction_previous_round</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fraction_neighbors_scores</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">fraction_neighbors_scores</span> <span class="o">=</span> <span class="p">{}</span>

                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_changed_history</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                        <span class="n">score</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_score&quot;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">score</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">fraction_neighbors_scores</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

                    <span class="k">if</span> <span class="n">fraction_neighbors_scores</span><span class="p">:</span>
                        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">fraction_neighbors_scores</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fraction_score_asign</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_graphics_to_metrics</span><span class="p">(</span>
            <span class="n">messages_number_message_count</span><span class="p">,</span>
            <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
            <span class="n">similarity_reputation</span><span class="p">,</span>
            <span class="n">fraction_score_asign</span><span class="p">,</span>
            <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
            <span class="n">addr</span><span class="p">,</span>
            <span class="n">nei</span><span class="p">,</span>
            <span class="n">current_round</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">total_rounds</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
            <span class="n">similarity_reputation</span><span class="p">,</span>
            <span class="n">fraction_score_asign</span><span class="p">,</span>
            <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error calculating reputation. Type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.calculate_weighted_values" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_weighted_values</span><span class="p">(</span><span class="n">avg_messages_number_message_normalized</span><span class="p">,</span> <span class="n">similarity_reputation</span><span class="p">,</span> <span class="n">fraction_score_asign</span><span class="p">,</span> <span class="n">avg_model_arrival_latency</span><span class="p">,</span> <span class="n">history_data</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation_metrics</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.calculate_weighted_values" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate the weighted values for each metric based on current measurements and historical data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>avg_messages_number_message_normalized</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized average message count.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>similarity_reputation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Reputation score based on model similarity.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction_score_asign</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Score assigned from fraction of parameters changed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>avg_model_arrival_latency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average model arrival latency.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>history_data</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Historical metrics data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The address of the current node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reputation_metrics</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary indicating which metrics are active.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_weighted_values</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
    <span class="n">similarity_reputation</span><span class="p">,</span>
    <span class="n">fraction_score_asign</span><span class="p">,</span>
    <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
    <span class="n">history_data</span><span class="p">,</span>
    <span class="n">current_round</span><span class="p">,</span>
    <span class="n">addr</span><span class="p">,</span>
    <span class="n">nei</span><span class="p">,</span>
    <span class="n">reputation_metrics</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the weighted values for each metric based on current measurements and historical data.</span>

<span class="sd">    Args:</span>
<span class="sd">        avg_messages_number_message_normalized (float): Normalized average message count.</span>
<span class="sd">        similarity_reputation (float): Reputation score based on model similarity.</span>
<span class="sd">        fraction_score_asign (float): Score assigned from fraction of parameters changed.</span>
<span class="sd">        avg_model_arrival_latency (float): Average model arrival latency.</span>
<span class="sd">        history_data (dict): Historical metrics data.</span>
<span class="sd">        current_round (int): The current round number.</span>
<span class="sd">        addr (str): The address of the current node.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        reputation_metrics (dict): Dictionary indicating which metrics are active.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">current_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">required_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;num_messages&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span>
            <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">:</span>
                <span class="n">history_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;num_messages&quot;</span><span class="p">:</span> <span class="n">avg_messages_number_message_normalized</span><span class="p">,</span>
            <span class="s2">&quot;model_similarity&quot;</span><span class="p">:</span> <span class="n">similarity_reputation</span><span class="p">,</span>
            <span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">:</span> <span class="n">fraction_score_asign</span><span class="p">,</span>
            <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span> <span class="n">avg_model_arrival_latency</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">active_metrics</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">metrics</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="kc">False</span><span class="p">)}</span>
        <span class="n">num_active_metrics</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">active_metrics</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
                <span class="s2">&quot;addr&quot;</span><span class="p">:</span> <span class="n">addr</span><span class="p">,</span>
                <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
                <span class="s2">&quot;metric_name&quot;</span><span class="p">:</span> <span class="n">metric_name</span><span class="p">,</span>
                <span class="s2">&quot;metric_value&quot;</span><span class="p">:</span> <span class="n">current_value</span><span class="p">,</span>
                <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">})</span>

        <span class="n">adjusted_weights</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span> <span class="ow">and</span> <span class="n">num_active_metrics</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">desviations</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">historical_values</span> <span class="o">=</span> <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

                <span class="n">metric_values</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">historical_values</span>
                    <span class="k">if</span> <span class="s2">&quot;metric_value&quot;</span> <span class="ow">in</span> <span class="n">entry</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_value&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
                <span class="p">]</span>

                <span class="k">if</span> <span class="n">metric_values</span><span class="p">:</span>
                    <span class="n">mean_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metric_values</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">mean_value</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">deviation</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">current_value</span> <span class="o">-</span> <span class="n">mean_value</span><span class="p">)</span>
                <span class="n">desviations</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">deviation</span>

            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">deviation</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="k">for</span> <span class="n">deviation</span> <span class="ow">in</span> <span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                <span class="n">random_weights</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_active_metrics</span><span class="p">)]</span>
                <span class="n">total_random_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">random_weights</span><span class="p">)</span>
                <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">metric_name</span><span class="p">:</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">total_random_weight</span>
                    <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">active_metrics</span><span class="p">,</span> <span class="n">random_weights</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">max_desviation</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="k">if</span> <span class="n">desviations</span> <span class="k">else</span> <span class="mi">1</span>
                <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">metric_name</span><span class="p">:</span> <span class="p">(</span><span class="n">desviation</span> <span class="o">/</span> <span class="n">max_desviation</span><span class="p">)</span> <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">desviation</span> <span class="ow">in</span> <span class="n">desviations</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">}</span>

                <span class="n">total_weight</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">normalized_weights</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">total_weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">metric_name</span><span class="p">:</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">total_weight</span> <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">normalized_weights</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">normalized_weights</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">num_active_metrics</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="p">}</span>

            <span class="n">mean_deviation</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">desviations</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">dynamic_min_weight</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mean_deviation</span> <span class="o">/</span> <span class="p">(</span><span class="n">mean_deviation</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

            <span class="n">total_adjusted_weight</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">weight</span> <span class="ow">in</span> <span class="n">normalized_weights</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="n">dynamic_min_weight</span><span class="p">:</span>
                    <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">dynamic_min_weight</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
                <span class="n">total_adjusted_weight</span> <span class="o">+=</span> <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">total_adjusted_weight</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">adjusted_weights</span><span class="p">:</span>
                    <span class="n">adjusted_weights</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">/=</span> <span class="n">total_adjusted_weight</span>
                <span class="n">total_adjusted_weight</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_weights</span> <span class="o">=</span> <span class="p">{</span><span class="n">metric_name</span><span class="p">:</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">num_active_metrics</span> <span class="k">for</span> <span class="n">metric_name</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="p">}</span>

        <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">current_value</span> <span class="ow">in</span> <span class="n">active_metrics</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">weight</span> <span class="o">=</span> <span class="n">adjusted_weights</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">metric_name</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">history_data</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;metric_name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">metric_name</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_round</span> <span class="ow">and</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;nei&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nei</span><span class="p">:</span>
                    <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.create_graphic_reputation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_graphic_reputation</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.create_graphic_reputation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a graphical representation of the reputation scores and log the data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_graphic_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">round_num</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a graphical representation of the reputation scores and log the data.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        round_num (int): The current round number.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">reputation_dict_with_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;Reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">node_id</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reputation dict: </span><span class="si">{</span><span class="n">reputation_dict_with_values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">reputation_dict_with_values</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">round_num</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error creating reputation graphic&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.create_graphics_to_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_graphics_to_metrics</span><span class="p">(</span><span class="n">number_message_count</span><span class="p">,</span> <span class="n">number_message_norm</span><span class="p">,</span> <span class="n">similarity</span><span class="p">,</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">model_arrival_latency</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">total_rounds</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.create_graphics_to_metrics" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create and log graphics representing different metric values over the rounds.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>number_message_count</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Count of messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_message_norm</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized number of messages.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>similarity</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Similarity metric value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction score metric.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_arrival_latency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latency metric score.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_rounds</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total rounds in the session.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_graphics_to_metrics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">number_message_count</span><span class="p">,</span>
    <span class="n">number_message_norm</span><span class="p">,</span>
    <span class="n">similarity</span><span class="p">,</span>
    <span class="n">fraction</span><span class="p">,</span>
    <span class="n">model_arrival_latency</span><span class="p">,</span>
    <span class="n">addr</span><span class="p">,</span>
    <span class="n">nei</span><span class="p">,</span>
    <span class="n">current_round</span><span class="p">,</span>
    <span class="n">total_rounds</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and log graphics representing different metric values over the rounds.</span>

<span class="sd">    Args:</span>
<span class="sd">        number_message_count (int): Count of messages.</span>
<span class="sd">        number_message_norm (float): Normalized number of messages.</span>
<span class="sd">        similarity (float): Similarity metric value.</span>
<span class="sd">        fraction (float): Fraction score metric.</span>
<span class="sd">        model_arrival_latency (float): Latency metric score.</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        current_round (int): The current round number.</span>
<span class="sd">        total_rounds (int): Total rounds in the session.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">current_round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&lt;</span> <span class="n">total_rounds</span><span class="p">:</span>
        <span class="n">model_arrival_latency_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Model_arrival_latency_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">model_arrival_latency</span><span class="p">}}</span>
        <span class="n">messages_number_message_count_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s2">&quot;R-Count_messages_number_message_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">number_message_count</span><span class="p">}</span>
        <span class="p">}</span>
        <span class="n">messages_number_message_norm_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-number_message_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">number_message_norm</span><span class="p">}}</span>
        <span class="n">similarity_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Similarity_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">similarity</span><span class="p">}}</span>
        <span class="n">fraction_dict</span> <span class="o">=</span> <span class="p">{</span><span class="sa">f</span><span class="s2">&quot;R-Fraction_reputation/</span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">nei</span><span class="p">:</span> <span class="n">fraction</span><span class="p">}}</span>

        <span class="k">if</span> <span class="n">messages_number_message_count_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">messages_number_message_count_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">messages_number_message_norm_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">messages_number_message_norm_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">similarity_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">similarity_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">fraction_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">fraction_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">model_arrival_latency_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">log_data</span><span class="p">(</span><span class="n">model_arrival_latency_dict</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">current_round</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.include_feedback_in_reputation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">include_feedback_in_reputation</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.include_feedback_in_reputation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Integrate feedback scores into the current reputation values.</p>
<p>The final reputation is computed as a weighted sum of the current reputation and the average feedback.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if feedback was successfully included, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">include_feedback_in_reputation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integrate feedback scores into the current reputation values.</span>

<span class="sd">    The final reputation is computed as a weighted sum of the current reputation and the average feedback.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if feedback was successfully included, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">weight_current_reputation</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">weight_feedback</span> <span class="o">=</span> <span class="mf">0.1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No feedback received.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">updated</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">current_node</span><span class="p">,</span> <span class="n">node_ip</span><span class="p">,</span> <span class="n">round_num</span><span class="p">),</span> <span class="n">scores</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_with_all_feedback</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">scores</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No feedback received for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">round_num</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">node_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No reputation for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;last_feedback_round&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">][</span><span class="s2">&quot;last_feedback_round&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">round_num</span>
        <span class="p">):</span>
            <span class="k">continue</span>

        <span class="n">avg_feedback</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Receive feedback to node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> with average score </span><span class="si">{</span><span class="n">avg_feedback</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">current_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">current_reputation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No reputation calculate for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">combined_reputation</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_reputation</span> <span class="o">*</span> <span class="n">weight_current_reputation</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">avg_feedback</span> <span class="o">*</span> <span class="n">weight_feedback</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Combined reputation for node </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">round_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">combined_reputation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">combined_reputation</span><span class="p">,</span>
            <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
            <span class="s2">&quot;last_feedback_round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updated self.reputation for </span><span class="si">{</span><span class="n">node_ip</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">node_ip</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">updated</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.init_reputation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_reputation</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">federation_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_feedback_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_reputation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.init_reputation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize the reputation for each federation node.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The address of the current node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>federation_nodes</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of federation nodes' addresses.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>last_feedback_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The last round in which feedback was provided.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>init_reputation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial reputation value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_reputation</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">federation_nodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">round_num</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_feedback_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">init_reputation</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the reputation for each federation node.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The address of the current node.</span>
<span class="sd">        federation_nodes (list): List of federation nodes&#39; addresses.</span>
<span class="sd">        round_num (int): The current round number.</span>
<span class="sd">        last_feedback_round (int): The last round in which feedback was provided.</span>
<span class="sd">        init_reputation (float): The initial reputation value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">federation_nodes</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;init_reputation | No federation nodes provided&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
        <span class="n">neighbors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_ip</span><span class="p">(</span><span class="n">federation_nodes</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;init_reputation | No neighbors found&quot;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">nei</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nei</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;reputation&quot;</span><span class="p">:</span> <span class="n">init_reputation</span><span class="p">,</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
                    <span class="s2">&quot;last_feedback_round&quot;</span><span class="p">:</span> <span class="n">last_feedback_round</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reputation&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">init_reputation</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">round_num</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="p">[</span><span class="n">nei</span><span class="p">][</span><span class="s2">&quot;last_feedback_round&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_feedback_round</span>

            <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">init_reputation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.is_valid_ip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_valid_ip</span><span class="p">(</span><span class="n">federation_nodes</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.is_valid_ip" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check if the IP addresses provided are valid.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>federation_nodes</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of federation node addresses.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of valid IP addresses.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_valid_ip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">federation_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the IP addresses provided are valid.</span>

<span class="sd">    Args:</span>
<span class="sd">        federation_nodes (list): List of federation node addresses.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of valid IP addresses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_ip</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">federation_nodes</span><span class="p">:</span>
        <span class="n">valid_ip</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">valid_ip</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.manage_metric_number_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_metric_number_message</span><span class="p">(</span><span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">metric_active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.manage_metric_number_message" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Manage and normalize the number of messages metric using percentiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>messages_number_message</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List containing message data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric_active</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating whether the metric is active.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple with the normalized number_message value (float) and the count of messages (int).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_metric_number_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">messages_number_message</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">current_round</span><span class="p">,</span> <span class="n">metric_active</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manage and normalize the number of messages metric using percentiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        messages_number_message (list): List containing message data.</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        current_round (int): The current round number.</span>
<span class="sd">        metric_active (bool): Flag indicating whether the metric is active.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple with the normalized number_message value (float) and the count of messages (int).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_round</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">metric_active</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>

        <span class="n">previous_round</span> <span class="o">=</span> <span class="n">current_round</span>

        <span class="n">current_addr_nei</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>
        <span class="n">relevant_messages</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">msg</span>
            <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">messages_number_message</span>
            <span class="k">if</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_addr_nei</span> <span class="ow">and</span> <span class="n">msg</span><span class="p">[</span><span class="s2">&quot;current_round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">previous_round</span>
        <span class="p">]</span>
        <span class="n">messages_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relevant_messages</span><span class="p">)</span> <span class="k">if</span> <span class="n">relevant_messages</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">previous_round</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="n">previous_round</span> <span class="o">-</span> <span class="mi">4</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">previous_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">previous_round</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rounds_to_consider</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">previous_counts</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">len</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">messages_number_message</span> <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">current_addr_nei</span> <span class="ow">and</span> <span class="n">m</span><span class="p">[</span><span class="s2">&quot;current_round&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">r</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rounds_to_consider</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span><span class="p">[</span><span class="n">current_addr_nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">previous_counts</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="n">previous_counts</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span><span class="p">[</span><span class="n">current_addr_nei</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">previous_counts</span><span class="p">,</span> <span class="mi">85</span><span class="p">)</span> <span class="k">if</span> <span class="n">previous_counts</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="p">)</span>

        <span class="n">normalized_messages</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">relative_position</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">previous_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">percentile_25</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_25_number_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_addr_nei</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">percentile_85</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">previous_percentile_85_number_message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_addr_nei</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">messages_count</span> <span class="o">&gt;</span> <span class="n">percentile_85</span><span class="p">:</span>
                <span class="n">relative_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">messages_count</span> <span class="o">-</span> <span class="n">percentile_85</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">percentile_85</span> <span class="o">-</span> <span class="n">percentile_25</span><span class="p">)</span>
                <span class="n">normalized_messages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">relative_position</span><span class="p">)</span>

            <span class="n">normalized_messages</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">normalized_messages</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">normalized_messages</span><span class="p">,</span> <span class="n">messages_count</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error managing metric number_message&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.manage_model_arrival_latency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">manage_model_arrival_latency</span><span class="p">(</span><span class="n">round_num</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.manage_model_arrival_latency" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Manage the model arrival latency metric and normalize it based on historical latencies.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>round_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The round number when the model was sent.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The address of the current node.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>latency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The measured latency.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Normalized latency score between 0 and 1.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">manage_model_arrival_latency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Manage the model arrival latency metric and normalize it based on historical latencies.</span>

<span class="sd">    Args:</span>
<span class="sd">        round_num (int): The round number when the model was sent.</span>
<span class="sd">        addr (str): The address of the current node.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        latency (float): The measured latency.</span>
<span class="sd">        current_round (int): The current round number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Normalized latency score between 0 and 1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_key</span> <span class="o">=</span> <span class="n">nei</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">prev_mean_latency</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prev_percentil_0</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prev_percentil_25</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">current_round</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">all_latencies</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">data</span><span class="p">[</span><span class="s2">&quot;latency&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="k">if</span> <span class="s2">&quot;latency&quot;</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;latency&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span>
            <span class="p">]</span>

            <span class="n">prev_mean_latency</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">prev_percentil_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="n">prev_percentil_25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">all_latencies</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">if</span> <span class="n">all_latencies</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="n">k</span> <span class="o">=</span> <span class="mf">0.1</span>
            <span class="n">prev_mean_latency</span> <span class="o">+=</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">prev_percentil_25</span> <span class="o">-</span> <span class="n">prev_percentil_0</span><span class="p">)</span>

            <span class="n">difference</span> <span class="o">=</span> <span class="n">latency</span> <span class="o">-</span> <span class="n">prev_mean_latency</span>
            <span class="k">if</span> <span class="n">latency</span> <span class="o">&lt;=</span> <span class="n">prev_mean_latency</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">score</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span> <span class="o">/</span> <span class="n">prev_mean_latency</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">round_num</span> <span class="o">&lt;</span> <span class="n">current_round</span><span class="p">:</span>
                <span class="n">round_diff</span> <span class="o">=</span> <span class="n">current_round</span> <span class="o">-</span> <span class="n">round_num</span>
                <span class="n">penalty_factor</span> <span class="o">=</span> <span class="n">round_diff</span> <span class="o">*</span> <span class="mf">0.1</span>
                <span class="n">penalty</span> <span class="o">=</span> <span class="n">penalty_factor</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">score</span><span class="p">)</span>
                <span class="n">score</span> <span class="o">-=</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">score</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="s2">&quot;mean_latency&quot;</span><span class="p">:</span> <span class="n">prev_mean_latency</span><span class="p">,</span>
                <span class="s2">&quot;percentil_0&quot;</span><span class="p">:</span> <span class="n">prev_percentil_0</span><span class="p">,</span>
                <span class="s2">&quot;percentil_25&quot;</span><span class="p">:</span> <span class="n">prev_percentil_25</span><span class="p">,</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">score</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">score</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error managing model_arrival_latency: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.on_round_start" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_round_start</span><span class="p">(</span><span class="n">rse</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.on_round_start" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Event handler for the start of a round. It stores the start time and updates the expected nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rse</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="RoundStartEvent (nebula.core.nebulaevents.RoundStartEvent)" href="../../../core/nebulaevents/#nebula.core.nebulaevents.RoundStartEvent">RoundStartEvent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event data containing round start information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">on_round_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rse</span><span class="p">:</span> <span class="n">RoundStartEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler for the start of a round. It stores the start time and updates the expected nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        rse (RoundStartEvent): The event data containing round start information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">round_id</span><span class="p">,</span> <span class="n">start_time</span><span class="p">,</span> <span class="n">expected_nodes</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">rse</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">round_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">round_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">round_id</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_time</span>
    <span class="n">expected_nodes</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.recollect_fraction_of_parameters_changed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recollect_fraction_of_parameters_changed</span><span class="p">(</span><span class="n">ure</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.recollect_fraction_of_parameters_changed" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Event handler to recollect the fraction of parameters changed when an update is received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ure</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="UpdateReceivedEvent (nebula.core.nebulaevents.UpdateReceivedEvent)" href="../../../core/nebulaevents/#nebula.core.nebulaevents.UpdateReceivedEvent">UpdateReceivedEvent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event data containing model update information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_fraction_of_parameters_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler to recollect the fraction of parameters changed when an update is received.</span>

<span class="sd">    Args:</span>
<span class="sd">        ure (UpdateReceivedEvent): The event data containing model update information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
    <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>
    <span class="n">parameters_local</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">()</span>
    <span class="n">parameters_received</span> <span class="o">=</span> <span class="n">decoded_model</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_params</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">changed_params</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">changes_record</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">prev_threshold</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">source</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]:</span>
        <span class="n">prev_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;threshold&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_local</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_received</span><span class="p">:</span>
            <span class="n">local_tensor</span> <span class="o">=</span> <span class="n">parameters_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="n">received_tensor</span> <span class="o">=</span> <span class="n">parameters_received</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">local_tensor</span> <span class="o">-</span> <span class="n">received_tensor</span><span class="p">)</span>
            <span class="n">differences</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="n">total_params</span> <span class="o">+=</span> <span class="n">diff</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">differences</span><span class="p">:</span>
        <span class="n">mean_threshold</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">differences</span><span class="p">))</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">current_threshold</span> <span class="o">=</span> <span class="p">(</span><span class="n">prev_threshold</span> <span class="o">+</span> <span class="n">mean_threshold</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">prev_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">mean_threshold</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">current_threshold</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_local</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">parameters_received</span><span class="p">:</span>
            <span class="n">local_tensor</span> <span class="o">=</span> <span class="n">parameters_local</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="n">received_tensor</span> <span class="o">=</span> <span class="n">parameters_received</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">local_tensor</span> <span class="o">-</span> <span class="n">received_tensor</span><span class="p">)</span>
            <span class="n">num_changed</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="n">current_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">changed_params</span> <span class="o">+=</span> <span class="n">num_changed</span>
            <span class="k">if</span> <span class="n">num_changed</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">changes_record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_changed</span>

    <span class="n">fraction_changed</span> <span class="o">=</span> <span class="n">changed_params</span> <span class="o">/</span> <span class="n">total_params</span> <span class="k">if</span> <span class="n">total_params</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="p">[</span><span class="n">source</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
        <span class="s2">&quot;total_params&quot;</span><span class="p">:</span> <span class="n">total_params</span><span class="p">,</span>
        <span class="s2">&quot;changed_params&quot;</span><span class="p">:</span> <span class="n">changed_params</span><span class="p">,</span>
        <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">current_threshold</span><span class="p">,</span>
        <span class="s2">&quot;changes_record&quot;</span><span class="p">:</span> <span class="n">changes_record</span><span class="p">,</span>
    <span class="p">})</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
        <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
        <span class="n">current_round</span><span class="p">,</span>
        <span class="n">fraction_changed</span><span class="o">=</span><span class="n">fraction_changed</span><span class="p">,</span>
        <span class="n">total_params</span><span class="o">=</span><span class="n">total_params</span><span class="p">,</span>
        <span class="n">changed_params</span><span class="o">=</span><span class="n">changed_params</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="n">current_threshold</span><span class="p">,</span>
        <span class="n">changes_record</span><span class="o">=</span><span class="n">changes_record</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.recollect_model_arrival_latency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recollect_model_arrival_latency</span><span class="p">(</span><span class="n">ure</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.recollect_model_arrival_latency" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Event handler to record the model arrival latency when an update is received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ure</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="UpdateReceivedEvent (nebula.core.nebulaevents.UpdateReceivedEvent)" href="../../../core/nebulaevents/#nebula.core.nebulaevents.UpdateReceivedEvent">UpdateReceivedEvent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event data for a model update.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_model_arrival_latency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler to record the model arrival latency when an update is received.</span>

<span class="sd">    Args:</span>
<span class="sd">        ure (UpdateReceivedEvent): The event data for a model update.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">current_round</span> <span class="o">=</span> <span class="n">round_num</span>

    <span class="k">if</span> <span class="n">current_round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="s2">&quot;model_received_time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">source</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">]:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_time</span>

        <span class="k">if</span> <span class="s2">&quot;start_time&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">]:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span>
            <span class="n">received_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;model_received_time&quot;</span><span class="p">][</span><span class="n">source</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">received_time</span> <span class="o">-</span> <span class="n">start</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">round_timing_info</span><span class="p">[</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">duration</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Source </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> , round </span><span class="si">{</span><span class="n">current_round</span><span class="si">}</span><span class="s2">, duration: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
                <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                <span class="n">num_round</span><span class="o">=</span><span class="n">current_round</span><span class="p">,</span>
                <span class="n">current_round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="n">latency</span><span class="o">=</span><span class="n">duration</span><span class="p">,</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model arrival latency already calculated for node </span><span class="si">{</span><span class="n">source</span><span class="si">}</span><span class="s2"> in round </span><span class="si">{</span><span class="n">current_round</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.recollect_number_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recollect_number_message</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.recollect_number_message" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Event handler to collect message count metrics when a message is received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>source</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The source node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The received message (content not used directly).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_number_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler to collect message count metrics when a message is received.</span>

<span class="sd">    Args:</span>
<span class="sd">        source (str): The source node&#39;s address.</span>
<span class="sd">        message: The received message (content not used directly).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">source</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">:</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save_data</span><span class="p">(</span>
                <span class="s2">&quot;number_message&quot;</span><span class="p">,</span>
                <span class="n">source</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">,</span>
                <span class="n">time</span><span class="o">=</span><span class="n">current_time</span><span class="p">,</span>
                <span class="n">current_round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.recollect_similarity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">recollect_similarity</span><span class="p">(</span><span class="n">ure</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.recollect_similarity" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Event handler to recollect and store model similarity metrics when an update is received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ure</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="UpdateReceivedEvent (nebula.core.nebulaevents.UpdateReceivedEvent)" href="../../../core/nebulaevents/#nebula.core.nebulaevents.UpdateReceivedEvent">UpdateReceivedEvent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The event data containing model update information.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">recollect_similarity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ure</span><span class="p">:</span> <span class="n">UpdateReceivedEvent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Event handler to recollect and store model similarity metrics when an update is received.</span>

<span class="sd">    Args:</span>
<span class="sd">        ure (UpdateReceivedEvent): The event data containing model update information.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="p">(</span><span class="n">decoded_model</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">round_num</span><span class="p">,</span> <span class="n">local</span><span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">ure</span><span class="o">.</span><span class="n">get_event_data</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">participant</span><span class="p">[</span><span class="s2">&quot;adaptive_args&quot;</span><span class="p">][</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">nei</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_addr</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🤖  handle_model_message | Checking model similarity&quot;</span><span class="p">)</span>
                <span class="n">cosine_value</span> <span class="o">=</span> <span class="n">cosine_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">euclidean_value</span> <span class="o">=</span> <span class="n">euclidean_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">minkowski_value</span> <span class="o">=</span> <span class="n">minkowski_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">manhattan_value</span> <span class="o">=</span> <span class="n">manhattan_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">pearson_correlation_value</span> <span class="o">=</span> <span class="n">pearson_correlation_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">jaccard_value</span> <span class="o">=</span> <span class="n">jaccard_metric</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">get_model_parameters</span><span class="p">(),</span>
                    <span class="n">decoded_model</span><span class="p">,</span>
                    <span class="n">similarity</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">similarity_metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                    <span class="s2">&quot;nei&quot;</span><span class="p">:</span> <span class="n">nei</span><span class="p">,</span>
                    <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">round_num</span><span class="p">,</span>
                    <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                    <span class="s2">&quot;cosine&quot;</span><span class="p">:</span> <span class="n">cosine_value</span><span class="p">,</span>
                    <span class="s2">&quot;euclidean&quot;</span><span class="p">:</span> <span class="n">euclidean_value</span><span class="p">,</span>
                    <span class="s2">&quot;minkowski&quot;</span><span class="p">:</span> <span class="n">minkowski_value</span><span class="p">,</span>
                    <span class="s2">&quot;manhattan&quot;</span><span class="p">:</span> <span class="n">manhattan_value</span><span class="p">,</span>
                    <span class="s2">&quot;pearson_correlation&quot;</span><span class="p">:</span> <span class="n">pearson_correlation_value</span><span class="p">,</span>
                    <span class="s2">&quot;jaccard&quot;</span><span class="p">:</span> <span class="n">jaccard_value</span><span class="p">,</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="n">nei</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">similarity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">similarity_metrics</span><span class="p">)</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Stored similarity metrics for </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">similarity_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No metrics instance found for neighbor </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">cosine_value</span> <span class="o">&lt;</span> <span class="mf">0.6</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;🤖  handle_model_message | Model similarity is less than 0.6&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nei</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.save_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_data</span><span class="p">(</span><span class="n">type_data</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">total_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">changed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">changes_record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.save_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save data received from nodes for further reputation calculations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>type_data</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of data being saved ("number_message", "fraction_of_params_changed", or "model_arrival_latency").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_round</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The round number associated with the data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>time</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timestamp or time value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction_changed</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Fraction of parameters changed.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>total_params</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total number of parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>changed_params</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of changed parameters.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold used for metrics.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>changes_record</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Record of parameter changes.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>latency</code>
            </td>
            <td>
                  <code><span title="optional">optional</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Latency value.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_data</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">type_data</span><span class="p">,</span>
    <span class="n">nei</span><span class="p">,</span>
    <span class="n">addr</span><span class="p">,</span>
    <span class="n">num_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">current_round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fraction_changed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">total_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">changed_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">changes_record</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">latency</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save data received from nodes for further reputation calculations.</span>

<span class="sd">    Args:</span>
<span class="sd">        type_data (str): The type of data being saved (&quot;number_message&quot;, &quot;fraction_of_params_changed&quot;, or &quot;model_arrival_latency&quot;).</span>
<span class="sd">        nei (str): The neighbor node address.</span>
<span class="sd">        addr (str): The current node address.</span>
<span class="sd">        num_round (optional): The round number associated with the data.</span>
<span class="sd">        time (optional): Timestamp or time value.</span>
<span class="sd">        current_round (optional): The current round number.</span>
<span class="sd">        fraction_changed (optional): Fraction of parameters changed.</span>
<span class="sd">        total_params (optional): Total number of parameters.</span>
<span class="sd">        changed_params (optional): Number of changed parameters.</span>
<span class="sd">        threshold (optional): Threshold used for metrics.</span>
<span class="sd">        changes_record (optional): Record of parameter changes.</span>
<span class="sd">        latency (optional): Latency value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">addr</span> <span class="o">==</span> <span class="n">nei</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">combined_data</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;number_message&quot;</span><span class="p">:</span>
            <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;number_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                <span class="s2">&quot;current_round&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">:</span>
            <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;fraction_changed&quot;</span><span class="p">:</span> <span class="n">fraction_changed</span><span class="p">,</span>
                <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span>
            <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;latency&quot;</span><span class="p">:</span> <span class="n">latency</span><span class="p">,</span>
                <span class="s2">&quot;round&quot;</span><span class="p">:</span> <span class="n">num_round</span><span class="p">,</span>
                <span class="s2">&quot;round_received&quot;</span><span class="p">:</span> <span class="n">current_round</span><span class="p">,</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">nei</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;number_message&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;number_message&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">fraction_of_params_changed</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;fraction_of_params_changed&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">type_data</span> <span class="o">==</span> <span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">connection_metrics</span><span class="p">[</span><span class="n">nei</span><span class="p">]</span><span class="o">.</span><span class="n">model_arrival_latency</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">combined_data</span><span class="p">[</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">])</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving data&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.save_model_arrival_latency_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_model_arrival_latency_history</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">model_arrival_latency</span><span class="p">,</span> <span class="n">round_num</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.save_model_arrival_latency_history" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save and update the model arrival latency history in memory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_arrival_latency</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized latency score.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated average model arrival latency.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_model_arrival_latency_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">model_arrival_latency</span><span class="p">,</span> <span class="n">round_num</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save and update the model arrival latency history in memory.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        model_arrival_latency (float): The normalized latency score.</span>
<span class="sd">        round_num (int): The current round number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The updated average model arrival latency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">current_key</span> <span class="o">=</span> <span class="n">nei</span>

        <span class="k">if</span> <span class="n">round_num</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">current_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">model_arrival_latency</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="k">if</span> <span class="n">model_arrival_latency</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_key</span><span class="p">,</span> <span class="p">{})</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">model_arrival_latency</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.2</span>
                    <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                    <span class="k">else</span> <span class="n">model_arrival_latency</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">model_arrival_latency</span> <span class="o">-</span> <span class="p">(</span><span class="n">model_arrival_latency</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">model_arrival_latency</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">round_num</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">round_num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_key</span><span class="p">,</span> <span class="p">{})</span>
                <span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">previous_avg</span> <span class="o">-</span> <span class="p">(</span><span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_model_arrival_latency</span> <span class="o">=</span> <span class="n">model_arrival_latency</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_arrival_latency_history</span><span class="p">[</span><span class="n">round_num</span><span class="p">][</span><span class="n">current_key</span><span class="p">][</span><span class="s2">&quot;avg_model_arrival_latency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">avg_model_arrival_latency</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">avg_model_arrival_latency</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving model_arrival_latency history&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.save_number_message_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_number_message_history</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.save_number_message_history" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the normalized number_message history in memory and calculate a weighted average.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>messages_number_message_normalized</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The normalized number_message value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_round</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current round number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The weighted average of the number_message metric.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_number_message_history</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">messages_number_message_normalized</span><span class="p">,</span> <span class="n">current_round</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the normalized number_message history in memory and calculate a weighted average.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        messages_number_message_normalized (float): The normalized number_message value.</span>
<span class="sd">        current_round (int): The current round number.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The weighted average of the number_message metric.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>
        <span class="n">avg_number_message</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;number_message&quot;</span><span class="p">:</span> <span class="n">messages_number_message_normalized</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">messages_number_message_normalized</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">current_round</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">previous_avg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">current_round</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">previous_avg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">avg_number_message</span> <span class="o">=</span> <span class="n">messages_number_message_normalized</span> <span class="o">*</span> <span class="mf">0.8</span> <span class="o">+</span> <span class="n">previous_avg</span> <span class="o">*</span> <span class="mf">0.2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">avg_number_message</span> <span class="o">=</span> <span class="n">messages_number_message_normalized</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">number_message_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">][</span><span class="s2">&quot;avg_number_message&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">avg_number_message</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_number_message</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">avg_number_message</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving number_message history&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error managing model_arrival_latency latency: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.save_reputation_history_in_memory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_reputation_history_in_memory</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation</span><span class="p">)</span></code>

<a href="#nebula.addons.reputation.reputation.Reputation.save_reputation_history_in_memory" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save the reputation history for a neighbor and compute an average reputation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>addr</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nei</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The neighbor node's address.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reputation</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The computed reputation for the current round.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated (weighted) reputation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save_reputation_history_in_memory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">,</span> <span class="n">reputation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the reputation history for a neighbor and compute an average reputation.</span>

<span class="sd">    Args:</span>
<span class="sd">        addr (str): The current node&#39;s address.</span>
<span class="sd">        nei (str): The neighbor node&#39;s address.</span>
<span class="sd">        reputation (float): The computed reputation for the current round.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The updated (weighted) reputation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">nei</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reputation</span>

        <span class="n">avg_reputation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">current_round</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span>
        <span class="n">rounds</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rounds</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">current_round</span> <span class="o">=</span> <span class="n">rounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">previous_round</span> <span class="o">=</span> <span class="n">rounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">current_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span>
            <span class="n">previous_rep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">previous_round</span><span class="p">]</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current reputation: </span><span class="si">{</span><span class="n">current_rep</span><span class="si">}</span><span class="s2">, Previous reputation: </span><span class="si">{</span><span class="n">previous_rep</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">avg_reputation</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_rep</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">previous_rep</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reputation ponderated: </span><span class="si">{</span><span class="n">avg_reputation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">avg_reputation</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation_history</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">current_round</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">avg_reputation</span>

    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error saving reputation history&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.send_reputation_to_neighbors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">send_reputation_to_neighbors</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.send_reputation_to_neighbors" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Send the calculated reputation scores to all neighbors.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>neighbors</code>
            </td>
            <td>
                  <code><span title="iterable">iterable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An iterable of neighbor node addresses.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_reputation_to_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neighbors</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Send the calculated reputation scores to all neighbors.</span>

<span class="sd">    Args:</span>
<span class="sd">        neighbors (iterable): An iterable of neighbor node addresses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">nei</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reputation</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">neighbors_to_send</span> <span class="o">=</span> <span class="p">[</span><span class="n">neighbor</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span> <span class="k">if</span> <span class="n">neighbor</span> <span class="o">!=</span> <span class="n">nei</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors_to_send</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">create_message</span><span class="p">(</span>
                    <span class="s2">&quot;reputation&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;share&quot;</span><span class="p">,</span>
                    <span class="n">node_id</span><span class="o">=</span><span class="n">nei</span><span class="p">,</span>
                    <span class="n">score</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;reputation&quot;</span><span class="p">]),</span>
                    <span class="nb">round</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">neighbor</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Sending reputation to node </span><span class="si">{</span><span class="n">nei</span><span class="si">}</span><span class="s2"> from node </span><span class="si">{</span><span class="n">neighbor</span><span class="si">}</span><span class="s2"> with reputation </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;reputation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.setup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.setup" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Setup the reputation system by subscribing to various events.</p>
<p>This function enables the reputation system and subscribes to events based on active metrics.</p>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Setup the reputation system by subscribing to various events.</span>

<span class="sd">    This function enables the reputation system and subscribes to events based on active metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_with_reputation</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Reputation system enabled&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">RoundStartEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_round_start</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">AggregationEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_reputation</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_similarity&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span><span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_similarity</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fraction_parameters_changed&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span>
                <span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_fraction_of_parameters_changed</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;num_messages&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;update&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s2">&quot;initialization&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;alive&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;federation&quot;</span><span class="p">,</span> <span class="s2">&quot;federation_models_included&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe</span><span class="p">((</span><span class="s2">&quot;reputation&quot;</span><span class="p">,</span> <span class="s2">&quot;share&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_number_message</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reputation_metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_arrival_latency&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">await</span> <span class="n">EventManager</span><span class="o">.</span><span class="n">get_instance</span><span class="p">()</span><span class="o">.</span><span class="n">subscribe_node_event</span><span class="p">(</span>
                <span class="n">UpdateReceivedEvent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">recollect_model_arrival_latency</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="nebula.addons.reputation.reputation.Reputation.update_process_aggregation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_process_aggregation</span><span class="p">(</span><span class="n">updates</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#nebula.addons.reputation.reputation.Reputation.update_process_aggregation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Update the aggregation process by removing nodes that have been rejected.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>updates</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary of updates.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>nebula/addons/reputation/reputation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_process_aggregation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">updates</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the aggregation process by removing nodes that have been rejected.</span>

<span class="sd">    Args:</span>
<span class="sd">        updates (dict): The dictionary of updates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">rn</span> <span class="ow">in</span> <span class="n">updates</span><span class="p">:</span>
            <span class="n">updates</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">rn</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updates after rejected nodes: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">updates</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;rejected nodes after clear at round </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_engine</span><span class="o">.</span><span class="n">get_round</span><span class="p">()</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">rejected_nodes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="May 25, 2025 16:56:21">May 25, 2025</span>
  </span>

    
    
    
    
  </aside>



  



                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Created by <a href="https://enriquetomasmb.com">Enrique Tomás Martínez Beltrán</a>.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/CyberDataLab/nebula" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://pypi.org/project/nebula-dfl" target="_blank" rel="noopener" title="pypi.org" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6M286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3M167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4m-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:enriquetomas@um.es" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../js/toc.js"></script>
      
    
  </body>
</html>